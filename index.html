<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CRACKUZU</title>

  <style>
    :root{
      --bg0:#0b0e12;
      --bg1:#10151b;
      --glass: rgba(255,255,255,.065);
      --glass2: rgba(255,255,255,.045);
      --stroke: rgba(255,255,255,.11);
      --stroke2: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --outer: clamp(14px, 2.2vw, 26px);
      --gap:   clamp(12px, 1.2vw, 18px);
      --pad:   clamp(14px, 1.6vw, 20px);
      --r-xl:  clamp(18px, 2vw, 26px);
      --r-md:  clamp(14px, 1.5vw, 18px);
      --shadow: 0 28px 90px rgba(0,0,0,.58);
      --shadow2: 0 18px 46px rgba(0,0,0,.45);
      --side: clamp(250px, 20vw, 330px);
      --cardW: clamp(140px, 10.5vw, 185px);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1100px 700px at 15% 0%, rgba(255,255,255,.09), transparent 55%),
        radial-gradient(950px 600px at 90% 20%, rgba(255,255,255,.07), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .glass{
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
    }
    @supports ((-webkit-backdrop-filter: blur(10px)) or (backdrop-filter: blur(10px))){
      .glass{
        -webkit-backdrop-filter: blur(14px);
        backdrop-filter: blur(14px);
      }
    }

    .app{
      min-height: 100vh;
      min-height: 100dvh;
      padding: var(--outer);
      width: 100%;
    }

    .shell{
      width: min(1800px, calc(100dvw - (2 * var(--outer))));
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      gap: var(--gap);
      min-height: calc(100dvh - (2 * var(--outer)));
    }

    header{
      border-radius: var(--r-xl);
      padding: var(--pad);
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:center;
      gap: var(--gap);
      min-height: clamp(86px, 10vh, 120px);
    }

    .brand{
      text-align:center;
      user-select:none;
      line-height:1.05;
    }
    .brand .big{
      font-weight: 300;
      letter-spacing: clamp(1px, .25vw, 2.5px);
      font-size: clamp(28px, 3.2vw, 46px);
      opacity:.92;
    }
    .brand .small{
      margin-top: 4px;
      font-size: clamp(12px, 1.1vw, 14px);
      letter-spacing: clamp(2px, .35vw, 3.5px);
      color: var(--muted);
      display:inline-flex;
      align-items:center;
      gap: 8px;
      cursor: pointer;
    }
    .brand .small:hover{ color: rgba(255,255,255,.78); }

    .pill{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.70);
      letter-spacing: 1px;
    }

    .search{
      width: clamp(220px, 26vw, 360px);
      height: clamp(34px, 4.2vh, 40px);
      border-radius: 999px;
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 0 14px;
      border: none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.16);
      background: rgba(255,255,255,.085);
      justify-self:end;
      outline: none !important;
      isolation: isolate;
      transform: translateZ(0);
    }
    .search:focus-within{
      outline: none !important;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.16);
    }
    .search *{
      outline: none !important;
      box-shadow: none !important;
    }
    .search svg{ width: 18px; height: 18px; opacity:.78; }
    .search input{
      width:100%;
      border:0 !important;
      outline:0 !important;
      box-shadow:none !important;
      background:transparent;
      color: var(--text);
      font-size: clamp(13px, 1.1vw, 14px);
    }
    .search input:focus{
      outline:none !important;
      border:none !important;
      box-shadow:none !important;
    }
    .search input::placeholder{ color: rgba(255,255,255,.55); }

    .main{
      flex: 1;
      min-height: 0;
      display:grid;
      grid-template-columns: var(--side) 1fr;
      gap: var(--gap);
    }

    aside{
      border-radius: var(--r-xl);
      padding: var(--pad);
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      min-height: 0;
    }

    aside h2{
      margin: 6px 0 12px;
      text-align:center;
      font-weight: 300;
      letter-spacing: clamp(1px, .3vw, 2.2px);
      font-size: clamp(22px, 2.3vw, 28px);
      color: rgba(255,255,255,.86);
    }

    .catlist{
      display:flex;
      flex-direction:column;
      gap: clamp(10px, 1.2vw, 14px);
      margin-top: clamp(10px, 1.3vw, 18px);
    }

    .catbtn{
      height: clamp(46px, 5.8vh, 54px);
      border-radius: clamp(14px, 1.4vw, 16px);
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 12px;
      font-weight: 520;
      letter-spacing: 1px;
      color: rgba(255,255,255,.70);
      cursor:pointer;
      transition: transform .15s ease, background .15s ease, border-color .15s ease, color .15s ease;
      user-select:none;
    }
    .catbtn:hover{
      background: rgba(255,255,255,.14);
      border-color: rgba(255,255,255,.25);
      transform: translateY(-1px);
      color: rgba(255,255,255,.86);
    }
    .catbtn.active{
      background: rgba(255,255,255,.16);
      border-color: rgba(255,255,255,.28);
      color: rgba(255,255,255,.92);
    }

    .sidefoot{
      margin-top:auto;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      color: rgba(255,255,255,.55);
      font-size: clamp(12px, 1.05vw, 13px);
      letter-spacing: .8px;
    }
    .sidefoot .boondocks{ color: rgba(255,255,255,.55); text-decoration: none; }
    .sidefoot .boondocks:hover{ color: rgba(255,255,255,.80); text-decoration: underline; }

    section{
      border-radius: var(--r-xl);
      padding: var(--pad);
      box-shadow: var(--shadow);
      min-height: 0;
      overflow:auto;
    }

    .grid{
      display:grid;
      gap: var(--gap);
      grid-template-columns: repeat(auto-fill, minmax(var(--cardW), 1fr));
      align-content: start;
    }

    .card{
      position: relative;
      border-radius: var(--r-md);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      box-shadow: 0 16px 40px rgba(0,0,0,.45);
      aspect-ratio: 3 / 4;
      cursor: pointer;
      transform: translateZ(0);
      transition: transform .22s ease, border-color .22s ease, box-shadow .22s ease;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;
      pointer-events:none;
      opacity:0;
      transition: opacity .22s ease;
      background:
        radial-gradient(600px 260px at 30% 10%, rgba(170,140,255,.28), transparent 60%),
        radial-gradient(500px 240px at 80% 90%, rgba(0,210,255,.20), transparent 55%);
    }
    .card::after{
      content:"";
      position:absolute;
      inset:-18px;
      border-radius: inherit;
      pointer-events:none;
      opacity:0;
      transition: opacity .22s ease;
      background:
        radial-gradient(340px 220px at 50% 50%, rgba(255,255,255,.11), transparent 48%);
    }

    .card:hover{
      transform: translateY(-3px);
      border-color: rgba(255,255,255,.20);
      box-shadow: 0 24px 58px rgba(0,0,0,.56);
    }
    .card:hover::before, .card:hover::after{ opacity:1; }

    .card img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      user-select:none;
      pointer-events:none;
    }

    .modal{
      position: fixed;
      inset:0;
      z-index:100;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: var(--outer);
      pointer-events:none;
      opacity:0;
      transition: opacity .24s ease;
      background: rgba(0,0,0,.76);
    }
    .modal.open{
      pointer-events: auto;
      opacity: 1;
    }

    .modalbox{
      border-radius: var(--r-xl);
      padding: clamp(20px, 2vw, 28px);
      box-shadow: var(--shadow);
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border: 1px solid var(--stroke2);
      width: min(800px, 90vw);
      max-height: 85vh;
      overflow:auto;
      transform: scale(.94);
      transition: transform .24s ease;
    }
    .modal.open .modalbox{
      transform: scale(1);
    }

    .modaltop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom: 22px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .modaltop h2{
      margin:0;
      font-weight:300;
      letter-spacing: 2px;
      font-size: clamp(22px, 2.2vw, 28px);
      color: rgba(255,255,255,.86);
    }
    .closebtn{
      width:34px;
      height:34px;
      border-radius:9px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      cursor:pointer;
      transition: background .12s ease;
    }
    .closebtn:hover{ background: rgba(255,255,255,.14); }
    .closebtn svg{ width:18px; height:18px; opacity:.76; }

    .detailbox{
      display:flex;
      flex-direction:column;
      gap: clamp(14px, 1.6vw, 18px);
    }

    .rowinfo{
      display:grid;
      grid-template-columns: auto 1fr;
      gap: 16px;
      align-items:start;
    }

    .rowinfo .cover{
      width: clamp(160px, 18vw, 220px);
      aspect-ratio: 3/4;
      border-radius: clamp(12px, 1.2vw, 16px);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 18px 40px rgba(0,0,0,.55);
    }
    .rowinfo .cover img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .infotext h3{
      margin:0 0 10px;
      font-weight:500;
      font-size: clamp(20px, 2vw, 26px);
      color: rgba(255,255,255,.90);
      line-height:1.2;
    }

    .catbadges{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .badge{
      padding: 6px 12px;
      border-radius: 8px;
      font-size: clamp(11px, 1vw, 12px);
      font-weight:500;
      letter-spacing: .8px;
      color: rgba(255,255,255,.76);
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.16);
    }

    .magnetbtn{
      margin-top:18px;
      border-radius: clamp(12px, 1.2vw, 14px);
      padding: clamp(14px, 1.6vw, 18px) 0;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.14);
      color: rgba(255,255,255,.88);
      font-weight:520;
      font-size: clamp(14px, 1.3vw, 16px);
      letter-spacing: 1.2px;
      cursor: pointer;
      transition: background .15s ease, transform .15s ease;
      box-shadow: 0 10px 28px rgba(0,0,0,.35);
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
    }
    .magnetbtn:hover{
      background: rgba(255,255,255,.18);
      transform: translateY(-1px);
    }
    .magnetbtn svg{ width:20px; height:20px; opacity:.80; }

    .toaster{
      position:fixed;
      bottom:30px;
      left:50%;
      transform: translateX(-50%);
      padding: 14px 22px;
      border-radius: 10px;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.22);
      color: rgba(255,255,255,.90);
      font-size: 14px;
      font-weight:500;
      letter-spacing: .6px;
      box-shadow: 0 14px 38px rgba(0,0,0,.55);
      z-index:200;
      pointer-events:none;
      opacity:0;
      transition: opacity .24s ease;
    }
    @supports ((-webkit-backdrop-filter: blur(10px)) or (backdrop-filter: blur(10px))){
      .toaster{
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }
    }
    .toaster.show{
      opacity:1;
    }

    /* ================================================ */
    /*             ADMIN PANEL STYLES                   */
    /* ================================================ */
    .adminmodal{
      position:fixed;
      inset:0;
      z-index:300;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: var(--outer);
      pointer-events:none;
      opacity:0;
      transition: opacity .24s ease;
      background: rgba(0,0,0,.82);
    }
    .adminmodal.open{
      pointer-events: auto;
      opacity: 1;
    }

    .adminbox{
      border-radius: var(--r-xl);
      padding: clamp(22px, 2.2vw, 32px);
      box-shadow: var(--shadow);
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border: 1px solid var(--stroke2);
      width: min(1200px, 92vw);
      max-height: 90vh;
      display:flex;
      flex-direction:column;
      transform: scale(.92);
      transition: transform .24s ease;
    }
    @supports ((-webkit-backdrop-filter: blur(10px)) or (backdrop-filter: blur(10px))){
      .adminbox{
        -webkit-backdrop-filter: blur(18px);
        backdrop-filter: blur(18px);
      }
    }
    .adminmodal.open .adminbox{
      transform: scale(1);
    }

    .admintop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom: 20px;
      padding-bottom: 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .admintop h2{
      margin:0;
      font-weight:300;
      letter-spacing: 2px;
      font-size: clamp(24px, 2.5vw, 32px);
      color: rgba(255,255,255,.90);
    }

    .adminnav{
      display:flex;
      gap: 12px;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }

    .tabnav{
      padding: 12px 20px;
      background: transparent;
      border:none;
      border-bottom: 2px solid transparent;
      color: rgba(255,255,255,.62);
      font-weight:520;
      font-size: clamp(13px, 1.2vw, 15px);
      letter-spacing: 1px;
      cursor:pointer;
      transition: color .15s ease, border-color .15s ease;
    }
    .tabnav:hover{
      color: rgba(255,255,255,.80);
    }
    .tabnav.active{
      color: rgba(255,255,255,.92);
      border-color: rgba(255,255,255,.52);
    }

    .admincontent{
      flex:1;
      min-height:0;
      overflow:auto;
      padding-right: 8px;
    }

    .admintab{
      display:none;
    }
    .admintab.show{
      display:block;
    }

    .formgroup{
      margin-bottom: 18px;
    }
    .formlabel{
      display:block;
      margin-bottom: 8px;
      font-weight:520;
      font-size: clamp(12px, 1.1vw, 13px);
      letter-spacing: .8px;
      color: rgba(255,255,255,.76);
    }

    .forminput, .formtextarea{
      width:100%;
      border-radius: 10px;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-size: clamp(13px, 1.1vw, 14px);
      outline:none;
      transition: border-color .15s ease, background .15s ease;
    }
    .forminput:focus, .formtextarea:focus{
      border-color: rgba(255,255,255,.32);
      background: rgba(255,255,255,.10);
    }
    .formtextarea{
      resize:vertical;
      min-height: 80px;
      font-family: inherit;
    }

    .igdbgrid{
      display:grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      margin-top:12px;
    }

    .igdbcard{
      position:relative;
      border-radius: 10px;
      overflow:hidden;
      border: 2px solid transparent;
      cursor:pointer;
      aspect-ratio: 3/4;
      transition: border-color .15s ease, transform .15s ease;
    }
    .igdbcard img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .igdbcard:hover{
      border-color: rgba(255,255,255,.28);
      transform: translateY(-2px);
    }
    .igdbcard.selected{
      border-color: rgba(100,200,255,.76);
    }

    .selectedpreview{
      margin-top:16px;
      padding:16px;
      border-radius:12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      display:none;
      align-items:center;
      gap:14px;
    }
    .selectedpreview.show{
      display:flex;
    }
    .selectedpreview img{
      width: 80px;
      height: 106px;
      border-radius:8px;
      object-fit:cover;
      border: 1px solid rgba(255,255,255,.18);
    }
    .selectedpreview p{
      margin:0;
      font-size: clamp(13px, 1.1vw, 14px);
      color: rgba(255,255,255,.80);
    }

    .catselect{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      margin-top:12px;
    }

    .catcheckbox{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 8px 14px;
      border-radius:8px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      transition: background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .catcheckbox:hover{
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.26);
    }
    .catcheckbox input{
      margin:0;
      cursor:pointer;
      accent-color: rgba(100,200,255,.80);
    }
    .catcheckbox label{
      margin:0;
      font-size: clamp(12px, 1.05vw, 13px);
      color: rgba(255,255,255,.74);
      cursor:pointer;
      letter-spacing: .6px;
    }

    .btngrid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top:20px;
    }

    .btnaction{
      padding: 14px 20px;
      border-radius:10px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.12);
      color: rgba(255,255,255,.88);
      font-weight:520;
      font-size: clamp(13px, 1.2vw, 14px);
      letter-spacing: .8px;
      cursor:pointer;
      transition: background .15s ease, transform .15s ease;
    }
    .btnaction:hover{
      background: rgba(255,255,255,.18);
      transform: translateY(-1px);
    }
    .btnaction.primary{
      background: rgba(100,200,255,.22);
      border-color: rgba(100,200,255,.40);
      color: rgba(255,255,255,.92);
    }
    .btnaction.primary:hover{
      background: rgba(100,200,255,.30);
    }

    .btnaction.danger{
      background: rgba(255,80,80,.16);
      border-color: rgba(255,80,80,.32);
    }
    .btnaction.danger:hover{
      background: rgba(255,80,80,.24);
    }

    .editmode{
      background: rgba(255,200,80,.16) !important;
      border-color: rgba(255,200,80,.36) !important;
    }

    /* ================================================ */
    /*    AM√âLIORATION: Liste scrollable + filtrage     */
    /* ================================================ */
    .listcontainer{
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 400px; /* Hauteur fixe pour rendre scrollable */
      overflow-y: auto;
      padding-right: 8px;
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 10px;
      padding: 12px;
      background: rgba(0,0,0,.12);
    }

    .listcontainer::-webkit-scrollbar {
      width: 8px;
    }

    .listcontainer::-webkit-scrollbar-track {
      background: rgba(255,255,255,.04);
      border-radius: 10px;
    }

    .listcontainer::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,.18);
      border-radius: 10px;
    }

    .listcontainer::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,.28);
    }

    /* Champ de recherche admin */
    .adminsearch{
      width: 100%;
      margin-bottom: 12px;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(255,255,255,.08);
      color: var(--text);
      font-size: clamp(13px, 1.1vw, 14px);
      outline: none;
      transition: border-color .15s ease, background .15s ease;
    }

    .adminsearch:focus{
      border-color: rgba(255,255,255,.32);
      background: rgba(255,255,255,.12);
    }

    .adminsearch::placeholder{
      color: rgba(255,255,255,.50);
    }

    .listitem{
      padding: 14px;
      border-radius:10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      transition: background .15s ease, border-color .15s ease;
    }
    .listitem:hover{
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.22);
    }

    .listitem .name{
      flex:1;
      font-size: clamp(13px, 1.1vw, 14px);
      color: rgba(255,255,255,.86);
      letter-spacing: .5px;
    }

    .listitem .actions{
      display:flex;
      gap:8px;
    }

    .smolbtn{
      padding: 6px 12px;
      border-radius:6px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.76);
      font-size: 12px;
      font-weight:500;
      cursor:pointer;
      transition: background .12s ease;
    }
    .smolbtn:hover{
      background: rgba(255,255,255,.14);
    }
    .smolbtn.edit{ background: rgba(100,200,255,.14); border-color: rgba(100,200,255,.28); }
    .smolbtn.edit:hover{ background: rgba(100,200,255,.22); }
    .smolbtn.delete{ background: rgba(255,80,80,.14); border-color: rgba(255,80,80,.26); }
    .smolbtn.delete:hover{ background: rgba(255,80,80,.22); }

    .statemsg{
      margin-top:16px;
      padding:12px;
      border-radius:8px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      text-align:center;
      font-size: clamp(12px, 1.05vw, 13px);
      color: rgba(255,255,255,.76);
      letter-spacing: .6px;
    }

    /* Bouton Upload to GitHub (ex Param√®tres) */
    .uploadbtn{
      padding: 14px 20px;
      border-radius:10px;
      border: 1px solid rgba(100,255,180,.30);
      background: rgba(100,255,180,.14);
      color: rgba(255,255,255,.90);
      font-weight:600;
      font-size: clamp(13px, 1.2vw, 15px);
      letter-spacing: 1px;
      cursor:pointer;
      transition: background .15s ease, transform .15s ease, box-shadow .15s ease;
      box-shadow: 0 8px 24px rgba(100,255,180,.18);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .uploadbtn:hover{
      background: rgba(100,255,180,.22);
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(100,255,180,.26);
    }

    /* Indicateur de chargement d'image */
    .imageloader{
      margin-top: 8px;
      padding: 10px;
      border-radius: 8px;
      background: rgba(100,200,255,.12);
      border: 1px solid rgba(100,200,255,.24);
      color: rgba(255,255,255,.82);
      font-size: 12px;
      text-align: center;
      display: none;
    }
    .imageloader.show{
      display: block;
    }

    @media (max-width: 900px){
      .main{
        grid-template-columns: 1fr;
      }
      aside{
        order:2;
      }
      section{
        order:1;
      }
      .adminbox{
        width: 95vw;
        max-height: 92vh;
      }
      .btngrid{
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="shell">
      <header class="glass">
        <div class="brand">
          <div class="big">CRACKUZU</div>
          <div class="small" id="adminEntry">
            PLATEFORME CRACKED
            <span class="pill" id="adminPill" style="display:none;">ADMIN</span>
          </div>
        </div>
        <div class="search">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
          <input type="text" placeholder="Rechercher un jeu..." id="q" autocomplete="off" />
        </div>
      </header>

      <div class="main">
        <aside class="glass">
          <h2>Cat√©gories</h2>
          <div class="catlist" id="catlist"></div>
          <div class="sidefoot">
            <span>¬© 2025 CRACKUZU</span>
            <a href="https://boondocks.fr" target="_blank" rel="noopener" class="boondocks">Boondocks</a>
          </div>
        </aside>

        <section class="glass">
          <div class="grid" id="grid"></div>
        </section>
      </div>
    </div>
  </div>

  <!-- MODAL D√âTAIL JEU -->
  <div class="modal" id="modal" aria-hidden="true" role="dialog">
    <div class="modalbox">
      <div class="modaltop">
        <h2 id="modalTitle"></h2>
        <button class="closebtn" id="closeModal" aria-label="Fermer">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="detailbox">
        <div class="rowinfo">
          <div class="cover"><img id="modalCover" alt="" /></div>
          <div class="infotext">
            <h3 id="modalName"></h3>
            <div class="catbadges" id="modalCats"></div>
            <button class="magnetbtn" id="magnetBtn">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              T√âL√âCHARGER LE JEU
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL ADMIN -->
  <div class="adminmodal" id="adminModal" aria-hidden="true" role="dialog">
    <div class="adminbox">
      <div class="admintop">
        <h2>PANNEAU ADMIN</h2>
        <button class="closebtn" id="closeAdmin" aria-label="Fermer">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>

      <div class="adminnav">
        <button class="tabnav active" data-tab="ajouter">Ajouter un jeu</button>
        <button class="tabnav" data-tab="bibliotheque">Ma Biblioth√®que</button>
        <button class="tabnav" data-tab="categories">G√©rer cat√©gories</button>
        <button class="tabnav" data-tab="config">Configuration</button>
      </div>

      <div class="admincontent">
        <!-- TAB: Ajouter un jeu -->
        <div class="admintab show" data-tab-content="ajouter">
          <div class="formgroup">
            <label class="formlabel">Nom du jeu</label>
            <input type="text" class="forminput" id="gameName" placeholder="Ex: Cyberpunk 2077" />
          </div>

          <div class="formgroup">
            <label class="formlabel">Rechercher sur IGDB</label>
            <input type="text" class="forminput" id="igdbSearch" placeholder="Taper pour chercher..." />
            <div class="igdbgrid" id="igdbResults"></div>
            <div class="selectedpreview" id="selectedGamePreview">
              <img id="selectedGameCover" alt="" />
              <p id="selectedGameName"></p>
            </div>
          </div>

          <div class="formgroup">
            <label class="formlabel">URL Cover (Cloudinary ou autre)</label>
            <input type="text" class="forminput" id="gameCover" placeholder="Collez une image (Ctrl+V support√©)" />
            <div class="imageloader" id="imageLoader">‚è≥ Upload en cours vers Cloudinary...</div>
          </div>

          <div class="formgroup">
            <label class="formlabel">Lien Magnet</label>
            <textarea class="formtextarea" id="gameMagnet" placeholder="magnet:?xt=..."></textarea>
          </div>

          <div class="formgroup">
            <label class="formlabel">Cat√©gories</label>
            <div class="catselect" id="catSelect"></div>
          </div>

          <div class="btngrid">
            <button class="btnaction primary" id="addGameBtn">Ajouter le jeu</button>
            <button class="btnaction editmode" id="saveEditBtn" style="display:none;">Sauvegarder modif</button>
            <button class="btnaction" id="cancelEditBtn" style="display:none;">Annuler modif</button>
          </div>
        </div>

        <!-- TAB: Ma Biblioth√®que (avec filtrage et scroll) -->
        <div class="admintab" data-tab-content="bibliotheque">
          <input type="text" class="adminsearch" id="adminGameSearch" placeholder="üîç Filtrer les jeux..." />
          <div class="listcontainer" id="adminGameList"></div>
        </div>

        <!-- TAB: G√©rer cat√©gories -->
        <div class="admintab" data-tab-content="categories">
          <div class="formgroup">
            <label class="formlabel">Nouvelle cat√©gorie</label>
            <input type="text" class="forminput" id="newCatName" placeholder="Ex: RPG" />
          </div>
          <button class="btnaction primary" id="addCatBtn">Ajouter cat√©gorie</button>
          <input type="text" class="adminsearch" id="adminCatSearch" placeholder="üîç Filtrer les cat√©gories..." />
          <div class="listcontainer" id="adminCatList"></div>
        </div>

        <!-- TAB: Configuration -->
        <div class="admintab" data-tab-content="config">
          <div class="formgroup">
            <label class="formlabel">GitHub Token</label>
            <input type="password" class="forminput" id="githubToken" placeholder="ghp_..." />
            <button class="btnaction" id="saveTokenBtn">Sauvegarder Token</button>
          </div>

          <div class="formgroup">
            <label class="formlabel">Cloudflare Worker URL</label>
            <input type="text" class="forminput" id="workerUrl" placeholder="https://worker.example.workers.dev" />
            <button class="btnaction" id="saveWorkerBtn">Sauvegarder URL</button>
          </div>

          <div class="btngrid">
            <button class="btnaction uploadbtn" id="publishBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
              Upload to GitHub
            </button>
            <button class="btnaction" id="exportBtn">Exporter JSON</button>
            <button class="btnaction" id="importBtn">Importer JSON</button>
            <button class="btnaction danger" id="resetBtn">Reset Draft</button>
          </div>

          <div class="statemsg" id="stateMsg"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="toaster" id="toaster"></div>

  <input type="file" id="filePick" accept="application/json" style="display:none;" />

  <script>
    const ADMIN_PASSWORD = "admin123";
    const REPO_OWNER = "Boondocks-0000";
    const REPO_NAME = "crackuzu-data";
    const REPO_PATH = "data.json";
    const REPO_BRANCH = "main";
    const DATA_URL = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/${REPO_BRANCH}/${REPO_PATH}`;
    const LOCAL_KEY = "crackuzu_local";
    const TOKEN_KEY = "crackuzu_gh_token";
    const WORKER_KEY = "crackuzu_worker_url";
    const CLOUDINARY_CLOUD_NAME = "votre-cloud-name"; // √Ä REMPLACER
    const CLOUDINARY_UPLOAD_PRESET = "votre-preset"; // √Ä REMPLACER

    const state = {
      data: { categories:[], games:[] },
      activeCat: "ALL",
      query: "",
      adminUnlocked: false,
      selectedCategories: [],
      adminGameFilter: "",
      adminCatFilter: ""
    };

    let editIndex = null;
    let selectedGameData = null;

    const q = document.getElementById("q");
    const grid = document.getElementById("grid");
    const catlist = document.getElementById("catlist");
    const modal = document.getElementById("modal");
    const closeModal = document.getElementById("closeModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalName = document.getElementById("modalName");
    const modalCover = document.getElementById("modalCover");
    const modalCats = document.getElementById("modalCats");
    const magnetBtn = document.getElementById("magnetBtn");
    const toaster = document.getElementById("toaster");
    const adminEntry = document.getElementById("adminEntry");
    const adminPill = document.getElementById("adminPill");
    const adminModal = document.getElementById("adminModal");
    const closeAdmin = document.getElementById("closeAdmin");
    const gameName = document.getElementById("gameName");
    const igdbSearch = document.getElementById("igdbSearch");
    const igdbResults = document.getElementById("igdbResults");
    const selectedGamePreview = document.getElementById("selectedGamePreview");
    const selectedGameCover = document.getElementById("selectedGameCover");
    const selectedGameName = document.getElementById("selectedGameName");
    const gameCover = document.getElementById("gameCover");
    const gameMagnet = document.getElementById("gameMagnet");
    const catSelect = document.getElementById("catSelect");
    const addGameBtn = document.getElementById("addGameBtn");
    const saveEditBtn = document.getElementById("saveEditBtn");
    const cancelEditBtn = document.getElementById("cancelEditBtn");
    const adminGameList = document.getElementById("adminGameList");
    const adminCatList = document.getElementById("adminCatList");
    const newCatName = document.getElementById("newCatName");
    const addCatBtn = document.getElementById("addCatBtn");
    const githubToken = document.getElementById("githubToken");
    const saveTokenBtn = document.getElementById("saveTokenBtn");
    const workerUrl = document.getElementById("workerUrl");
    const saveWorkerBtn = document.getElementById("saveWorkerBtn");
    const publishBtn = document.getElementById("publishBtn");
    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");
    const resetBtn = document.getElementById("resetBtn");
    const filePick = document.getElementById("filePick");
    const stateMsg = document.getElementById("stateMsg");
    const imageLoader = document.getElementById("imageLoader");
    const adminGameSearch = document.getElementById("adminGameSearch");
    const adminCatSearch = document.getElementById("adminCatSearch");

    // ============================================
    // GESTION DES ONGLETS ADMIN
    // ============================================
    document.querySelectorAll(".tabnav").forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.tab;
        document.querySelectorAll(".tabnav").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        document.querySelectorAll(".admintab").forEach(tab => tab.classList.remove("show"));
        document.querySelector(`[data-tab-content="${target}"]`).classList.add("show");
      });
    });

    // ============================================
    // FILTRES ADMIN
    // ============================================
    adminGameSearch.addEventListener("input", (e) => {
      state.adminGameFilter = e.target.value.trim().toLowerCase();
      renderAdminLists();
    });

    adminCatSearch.addEventListener("input", (e) => {
      state.adminCatFilter = e.target.value.trim().toLowerCase();
      renderAdminLists();
    });

    // ============================================
    // UPLOAD IMAGE CLOUDINARY (Ctrl+V)
    // ============================================
    gameCover.addEventListener("paste", async (e) => {
      const items = e.clipboardData?.items;
      if (!items) return;

      for (let i = 0; i < items.length; i++) {
        if (items[i].type.indexOf("image") !== -1) {
          e.preventDefault();
          const blob = items[i].getAsFile();
          await uploadToCloudinary(blob);
          break;
        }
      }
    });

    async function uploadToCloudinary(file) {
      if (!CLOUDINARY_CLOUD_NAME || !CLOUDINARY_UPLOAD_PRESET || CLOUDINARY_CLOUD_NAME === "votre-cloud-name") {
        toastMsg("‚ö†Ô∏è Configurez Cloudinary dans le code");
        return;
      }

      imageLoader.classList.add("show");
      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", CLOUDINARY_UPLOAD_PRESET);

      try {
        const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
          method: "POST",
          body: formData
        });
        const data = await res.json();
        if (data.secure_url) {
          gameCover.value = data.secure_url;
          toastMsg("‚úÖ Image upload√©e sur Cloudinary");
        } else {
          toastMsg("‚ùå Erreur Cloudinary");
        }
      } catch (err) {
        console.error(err);
        toastMsg("‚ùå √âchec upload Cloudinary");
      } finally {
        imageLoader.classList.remove("show");
      }
    }

    // ============================================
    // FONCTIONS UTILITAIRES
    // ============================================
    function norm(s){ return s.trim(); }

    function sanitizeData(d){
      if(!d || typeof d !== "object") return { categories:[], games:[] };
      const cats = Array.isArray(d.categories) ? d.categories : [];
      const games = Array.isArray(d.games) ? d.games : [];
      return { categories: cats, games: games.filter(g => g && g.name && g.cover && g.magnet) };
    }

    async function loadDataFromRepo(){
      try{
        const res = await fetch(DATA_URL);
        if(!res.ok) throw new Error("Fichier introuvable");
        const raw = await res.json();
        return sanitizeData(raw);
      }catch(err){
        console.error("Erreur chargement repo:", err);
        return null;
      }
    }

    function saveLocalDraft(){
      localStorage.setItem(LOCAL_KEY, JSON.stringify(state.data));
    }

    function loadLocalDraft(){
      const raw = localStorage.getItem(LOCAL_KEY);
      if(!raw) return null;
      try{
        return sanitizeData(JSON.parse(raw));
      }catch{
        return null;
      }
    }

    function saveGithubToken(token){
      localStorage.setItem(TOKEN_KEY, token);
    }

    function loadGithubToken(){
      return localStorage.getItem(TOKEN_KEY) || "";
    }

    function saveWorkerUrl(url){
      localStorage.setItem(WORKER_KEY, url);
    }

    function loadWorkerUrl(){
      return localStorage.getItem(WORKER_KEY) || "";
    }

    function setStateMessage(msg){
      stateMsg.textContent = msg;
    }

    function toastMsg(msg){
      toaster.textContent = msg;
      toaster.classList.add("show");
      setTimeout(() => toaster.classList.remove("show"), 2600);
    }

    function renderCategories(){
      catlist.innerHTML = "";
      const all = document.createElement("div");
      all.className = "catbtn" + (state.activeCat === "ALL" ? " active" : "");
      all.textContent = "TOUS LES JEUX";
      all.addEventListener("click", () => {
        state.activeCat = "ALL";
        renderCategories();
        renderGames();
      });
      catlist.appendChild(all);

      state.data.categories.forEach(cat => {
        const btn = document.createElement("div");
        btn.className = "catbtn" + (state.activeCat === cat ? " active" : "");
        btn.textContent = cat.toUpperCase();
        btn.addEventListener("click", () => {
          state.activeCat = cat;
          renderCategories();
          renderGames();
        });
        catlist.appendChild(btn);
      });
    }

    function renderGames(){
      grid.innerHTML = "";
      let filtered = state.data.games;

      if(state.activeCat !== "ALL"){
        filtered = filtered.filter(g => g.categories && g.categories.includes(state.activeCat));
      }

      if(state.query){
        const lower = state.query.toLowerCase();
        filtered = filtered.filter(g => g.name.toLowerCase().includes(lower));
      }

      filtered.forEach(g => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<img src="${g.cover}" alt="${g.name}" />`;
        card.addEventListener("click", () => openGameModal(g));
        grid.appendChild(card);
      });

      if(filtered.length === 0){
        grid.innerHTML = '<p style="text-align:center;color:rgba(255,255,255,.62);margin-top:40px;">Aucun jeu trouv√©.</p>';
      }
    }

    function openGameModal(game){
      modalTitle.textContent = game.name;
      modalName.textContent = game.name;
      modalCover.src = game.cover;
      modalCats.innerHTML = "";
      (game.categories || []).forEach(cat => {
        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = cat.toUpperCase();
        modalCats.appendChild(badge);
      });
      magnetBtn.onclick = () => {
        window.location.href = game.magnet;
        toastMsg("Lancement du t√©l√©chargement...");
      };
      modal.classList.add("open");
      modal.setAttribute("aria-hidden", "false");
    }

    function renderAdminLists(){
      // Jeux
      adminGameList.innerHTML = "";
      let filteredGames = state.data.games;
      if (state.adminGameFilter) {
        filteredGames = filteredGames.filter(g => g.name.toLowerCase().includes(state.adminGameFilter));
      }

      filteredGames.forEach((g, i) => {
        const item = document.createElement("div");
        item.className = "listitem";
        item.innerHTML = `
          <span class="name">${g.name}</span>
          <div class="actions">
            <button class="smolbtn edit" data-index="${i}">Modifier</button>
            <button class="smolbtn delete" data-index="${i}">Supprimer</button>
          </div>
        `;
        adminGameList.appendChild(item);
      });

      adminGameList.querySelectorAll(".edit").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = parseInt(btn.dataset.index, 10);
          editGame(idx);
        });
      });

      adminGameList.querySelectorAll(".delete").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = parseInt(btn.dataset.index, 10);
          deleteGame(idx);
        });
      });

      // Cat√©gories
      adminCatList.innerHTML = "";
      let filteredCats = state.data.categories;
      if (state.adminCatFilter) {
        filteredCats = filteredCats.filter(c => c.toLowerCase().includes(state.adminCatFilter));
      }

      filteredCats.forEach((cat, i) => {
        const item = document.createElement("div");
        item.className = "listitem";
        item.innerHTML = `
          <span class="name">${cat}</span>
          <div class="actions">
            <button class="smolbtn delete" data-index="${i}">Supprimer</button>
          </div>
        `;
        adminCatList.appendChild(item);
      });

      adminCatList.querySelectorAll(".delete").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = parseInt(btn.dataset.index, 10);
          deleteCat(idx);
        });
      });

      // Checkboxes cat√©gories
      catSelect.innerHTML = "";
      state.data.categories.forEach(cat => {
        const lbl = document.createElement("label");
        lbl.className = "catcheckbox";
        const chk = document.createElement("input");
        chk.type = "checkbox";
        chk.value = cat;
        chk.checked = state.selectedCategories.includes(cat);
        chk.addEventListener("change", () => {
          if(chk.checked){
            if(!state.selectedCategories.includes(cat)) state.selectedCategories.push(cat);
          }else{
            state.selectedCategories = state.selectedCategories.filter(c => c !== cat);
          }
        });
        const txt = document.createElement("label");
        txt.textContent = cat;
        lbl.appendChild(chk);
        lbl.appendChild(txt);
        catSelect.appendChild(lbl);
      });
    }

    function editGame(idx){
      const g = state.data.games[idx];
      editIndex = idx;
      gameName.value = g.name;
      gameMagnet.value = g.magnet;
      gameCover.value = g.cover;
      state.selectedCategories = [...(g.categories || [])];

      selectedGameData = { name: g.name, cover: g.cover };
      selectedGamePreview.classList.add("show");
      selectedGameCover.src = g.cover;
      selectedGameName.textContent = g.name;

      addGameBtn.style.display = "none";
      saveEditBtn.style.display = "block";
      cancelEditBtn.style.display = "block";

      renderAdminLists();
      toastMsg("Mode modification activ√©");

      document.querySelector('[data-tab="ajouter"]').click();
    }

    function exitEditMode(){
      editIndex = null;
      gameName.value = "";
      gameMagnet.value = "";
      gameCover.value = "";
      state.selectedCategories = [];
      selectedGameData = null;
      selectedGamePreview.classList.remove("show");
      addGameBtn.style.display = "block";
      saveEditBtn.style.display = "none";
      cancelEditBtn.style.display = "none";
      renderAdminLists();
    }

    function deleteGame(idx){
      const ok = confirm("Supprimer ce jeu ?");
      if(!ok) return;
      state.data.games.splice(idx, 1);
      saveLocalDraft();
      renderGames();
      renderAdminLists();
      toastMsg("Jeu supprim√©");
    }

    function deleteCat(idx){
      const cat = state.data.categories[idx];
      const ok = confirm(`Supprimer "${cat}" ?`);
      if(!ok) return;
      state.data.categories.splice(idx, 1);
      state.data.games.forEach(g => {
        if(g.categories) g.categories = g.categories.filter(c => c !== cat);
      });
      saveLocalDraft();
      renderCategories();
      renderGames();
      renderAdminLists();
      toastMsg("Cat√©gorie supprim√©e");
    }

    // ============================================
    // RECHERCHE IGDB
    // ============================================
    let igdbTimeout = null;
    igdbSearch.addEventListener("input", () => {
      clearTimeout(igdbTimeout);
      const val = norm(igdbSearch.value);
      if(!val){
        igdbResults.innerHTML = "";
        return;
      }
      igdbTimeout = setTimeout(() => searchIGDB(val), 500);
    });

    async function searchIGDB(query){
      try{
        const res = await fetch("https://api.igdb.com/v4/games", {
          method:"POST",
          headers:{
            "Client-ID": "VOTRE_CLIENT_ID", // √Ä REMPLACER
            "Authorization": "Bearer VOTRE_ACCESS_TOKEN", // √Ä REMPLACER
            "Content-Type": "text/plain"
          },
          body: `search "${query}"; fields name, cover.url; limit 10;`
        });
        const data = await res.json();
        displayIGDBResults(data);
      }catch(err){
        console.error(err);
        igdbResults.innerHTML = '<p style="color:rgba(255,80,80,.80);padding:12px;">Erreur IGDB</p>';
      }
    }

    function displayIGDBResults(games){
      igdbResults.innerHTML = "";
      if(!games || games.length === 0){
        igdbResults.innerHTML = '<p style="color:rgba(255,255,255,.62);padding:12px;">Aucun r√©sultat</p>';
        return;
      }
      games.forEach(g => {
        if(!g.cover) return;
        const card = document.createElement("div");
        card.className = "igdbcard";
        const coverUrl = g.cover.url.replace("t_thumb", "t_cover_big");
        card.innerHTML = `<img src="https:${coverUrl}" alt="${g.name}" />`;
        card.addEventListener("click", () => selectIGDBGame(g.name, coverUrl));
        igdbResults.appendChild(card);
      });
    }

    function selectIGDBGame(name, coverUrl){
      selectedGameData = { name, cover: `https:${coverUrl}` };
      gameName.value = name;
      gameCover.value = selectedGameData.cover;
      selectedGamePreview.classList.add("show");
      selectedGameCover.src = selectedGameData.cover;
      selectedGameName.textContent = name;
      document.querySelectorAll(".igdbcard").forEach(c => c.classList.remove("selected"));
      event.currentTarget.classList.add("selected");
      toastMsg("Jeu s√©lectionn√©");
    }

    // ============================================
    // √âV√âNEMENTS ADMIN
    // ============================================
    q.addEventListener("input", () => {
      state.query = norm(q.value);
      renderGames();
    });

    addCatBtn.addEventListener("click", () => {
      const cat = norm(newCatName.value);
      if(!cat) return toastMsg("Nom vide");
      if(state.data.categories.includes(cat)) return toastMsg("D√©j√† existante");
      state.data.categories.push(cat);
      newCatName.value = "";
      saveLocalDraft();
      renderCategories();
      renderAdminLists();
      toastMsg("Cat√©gorie ajout√©e");
    });

    addGameBtn.addEventListener("click", () => {
      if(editIndex !== null) return toastMsg("Mode modif actif");

      const name = norm(gameName.value);
      const magnet = norm(gameMagnet.value).replaceAll("&amp;", "&");
      const cover = norm(gameCover.value);

      if(!name) return toastMsg("Nom manquant");
      if(!magnet.startsWith("magnet:")) return toastMsg("Magnet invalide");
      if(!cover) return toastMsg("S√©lectionne un jeu IGDB d'abord");
      if(state.selectedCategories.length === 0) return toastMsg("Pas de cat√©gories");

      state.selectedCategories.forEach(cat => {
        if(!state.data.categories.includes(cat)){
          state.data.categories.push(cat);
        }
      });

      state.data.games.unshift({ 
        name, 
        categories: [...state.selectedCategories], 
        magnet, 
        cover 
      });

      gameName.value = "";
      gameMagnet.value = "";
      gameCover.value = "";
      state.selectedCategories = [];
      selectedGameData = null;
      selectedGamePreview.classList.remove('show');

      saveLocalDraft();
      renderGames();
      renderCategories();
      renderAdminLists();
      toastMsg("Jeu ajout√©");
    });

    saveEditBtn.addEventListener("click", () => {
      if(editIndex === null) return;

      const name = norm(gameName.value);
      const magnet = norm(gameMagnet.value).replaceAll("&amp;", "&");
      const cover = norm(gameCover.value);

      if(!name) return toastMsg("Nom manquant");
      if(!magnet.startsWith("magnet:")) return toastMsg("Magnet invalide");
      if(!cover) return toastMsg("Cover manquante");
      if(state.selectedCategories.length === 0) return toastMsg("Pas de cat√©gories");

      state.selectedCategories.forEach(cat => {
        if(!state.data.categories.includes(cat)){
          state.data.categories.push(cat);
        }
      });

      state.data.games[editIndex] = { 
        name, 
        categories: [...state.selectedCategories], 
        magnet, 
        cover 
      };

      saveLocalDraft();
      renderGames();
      renderCategories();
      renderAdminLists();
      exitEditMode();
      toastMsg("Modif sauvegard√©e");
    });

    cancelEditBtn.addEventListener("click", exitEditMode);

    saveTokenBtn.addEventListener("click", () => {
      const token = githubToken.value.trim();
      if(!token){
        toastMsg("‚ö†Ô∏è Token vide");
        return;
      }
      saveGithubToken(token);
      toastMsg("‚úÖ Token sauvegard√©");
    });

    saveWorkerBtn.addEventListener("click", () => {
      const url = workerUrl.value.trim();
      if(!url){
        toastMsg("‚ö†Ô∏è URL vide");
        return;
      }
      if(!url.startsWith("http")){
        toastMsg("‚ö†Ô∏è URL invalide");
        return;
      }
      saveWorkerUrl(url);
      toastMsg("‚úÖ Worker URL sauvegard√©e");
    });

    publishBtn.addEventListener("click", async () => {
      const workerURL = loadWorkerUrl();
      if(!workerURL){
        toastMsg("‚ö†Ô∏è Configurez l'URL Worker d'abord");
        return;
      }

      const ok = confirm("Upload vers GitHub via Worker ?");
      if(!ok) return;

      setStateMessage("üì§ Upload en cours...");

      try{
        const res = await fetch(workerURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(state.data)
        });

        if(!res.ok){
          const errData = await res.text();
          throw new Error(errData || "Worker error");
        }

        localStorage.removeItem(LOCAL_KEY);
        setStateMessage("‚úÖ Upload r√©ussi sur GitHub");
        toastMsg("‚úÖ Publi√© !");
        setTimeout(() => setStateMessage(""), 4000);
      }catch(err){
        console.error(err);
        setStateMessage("‚ùå Erreur: " + err.message);
        toastMsg("‚ùå √âchec upload");
      }
    });

    exportBtn.addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(state.data, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "data.json";
      a.click();
      toastMsg("Export r√©ussi");
    });

    importBtn.addEventListener("click", () => filePick.click());
    
    filePick.addEventListener("change", async () => {
      const f = filePick.files?.[0];
      filePick.value = "";
      if(!f) return;
      try{
        const text = await f.text();
        const json = sanitizeData(JSON.parse(text));
        state.data = json;
        saveLocalDraft();
        renderCategories();
        renderGames();
        renderAdminLists();
        exitEditMode();
        toastMsg("Import OK");
      }catch{
        toastMsg("Import invalide");
      }
    });

    resetBtn.addEventListener("click", () => {
      const ok = confirm("Reset local ?");
      if(!ok) return;
      localStorage.removeItem(LOCAL_KEY);
      toastMsg("Draft supprim√©");
      init();
      closeAdminModal();
    });

    adminEntry.addEventListener("click", () => {
      const pwd = prompt("Admin password:");
      if(pwd === ADMIN_PASSWORD){
        state.adminUnlocked = true;
        adminPill.style.display = "inline-flex";
        toastMsg("Admin unlocked");
        openAdmin();
      }else{
        toastMsg("Wrong password");
      }
    });

    function openAdmin(){
      adminModal.classList.add("open");
      adminModal.setAttribute("aria-hidden", "false");
      renderAdminLists();
      githubToken.value = loadGithubToken();
      workerUrl.value = loadWorkerUrl();
    }
    
    function closeAdminModal(){
      adminModal.classList.remove("open");
      adminModal.setAttribute("aria-hidden", "true");
    }

    closeAdmin.addEventListener("click", closeAdminModal);
    adminModal.addEventListener("click", (e) => { if(e.target === adminModal) closeAdminModal(); });
    window.addEventListener("keydown", (e) => { if(e.key === "Escape") closeAdminModal(); });

    closeModal.addEventListener("click", () => {
      modal.classList.remove("open");
      modal.setAttribute("aria-hidden", "true");
    });
    modal.addEventListener("click", (e) => { 
      if(e.target === modal){
        modal.classList.remove("open");
        modal.setAttribute("aria-hidden", "true");
      }
    });

    // ============================================
    // INITIALISATION
    // ============================================
    async function init(){
      console.log("üéÆ CRACKUZU - Initialisation...");
      setStateMessage("Chargement des jeux...");

      try {
        const data = await loadDataFromRepo();
        
        if (data && data.games && data.games.length > 0) {
          console.log(`‚úÖ ${data.games.length} jeux charg√©s depuis data.json`);
          state.data = data;
          setStateMessage(`‚úÖ ${data.games.length} jeux charg√©s`);
          setTimeout(() => setStateMessage(""), 2000);
        } else {
          const localDraft = loadLocalDraft();
          if (localDraft && localDraft.games && localDraft.games.length > 0) {
            console.log(`üì¶ ${localDraft.games.length} jeux charg√©s depuis le draft local`);
            state.data = localDraft;
            setStateMessage(`üì¶ ${localDraft.games.length} jeux (draft local)`);
            setTimeout(() => setStateMessage(""), 2000);
          } else {
            console.warn("‚ö†Ô∏è Aucun jeu trouv√©. La biblioth√®que est vide.");
            setStateMessage("üì≠ Aucun jeu trouv√©. Ajoutez-en via le panneau admin.");
          }
        }
      } catch (error) {
        console.error("‚ùå Erreur lors du chargement:", error);
        setStateMessage("‚ùå Erreur de chargement. V√©rifiez la console.");
      }

      state.activeCat = "ALL";
      state.query = "";
      q.value = "";

      editIndex = null;
      exitEditMode();

      renderCategories();
      renderGames();
      renderAdminLists();
      
      console.log("‚úÖ Initialisation termin√©e");
    }

    init();
  </script>
</body>
</html>
