<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CRACKUZU</title>

  <style>
    :root{
      --bg0:#0b0e12;
      --bg1:#10151b;
      --glass: rgba(255,255,255,.065);
      --glass2: rgba(255,255,255,.045);
      --stroke: rgba(255,255,255,.11);
      --stroke2: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --outer: clamp(14px, 2.2vw, 26px);
      --gap:   clamp(12px, 1.2vw, 18px);
      --pad:   clamp(14px, 1.6vw, 20px);
      --r-xl:  clamp(18px, 2vw, 26px);
      --r-md:  clamp(14px, 1.5vw, 18px);
      --shadow: 0 28px 90px rgba(0,0,0,.58);
      --shadow2: 0 18px 46px rgba(0,0,0,.45);
      --side: clamp(250px, 20vw, 330px);
      --cardW: clamp(140px, 10.5vw, 185px);
      --accent: #a0a0ff;
      --accent-glow: rgba(160, 160, 255, 0.4);
    }

    /* ANIMATIONS */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes shimmer {
      0% { background-position: -200% center; }
      100% { background-position: 200% center; }
    }

    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 20px var(--accent-glow); }
      50% { box-shadow: 0 0 40px var(--accent-glow); }
    }

    @keyframes searchGlow {
      0%, 100% { 
        box-shadow: inset 0 0 0 1px rgba(255,255,255,.16),
                    0 0 0 0 transparent;
      }
      50% { 
        box-shadow: inset 0 0 0 1px rgba(160, 160, 255, .4),
                    0 0 25px rgba(160, 160, 255, .15);
      }
    }

    @keyframes iconFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-3px); }
    }

    @keyframes ripple {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(4);
        opacity: 0;
      }
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1100px 700px at 15% 0%, rgba(255,255,255,.09), transparent 55%),
        radial-gradient(950px 600px at 90% 20%, rgba(255,255,255,.07), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .glass{
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
    }
    @supports ((-webkit-backdrop-filter: blur(10px)) or (backdrop-filter: blur(10px))){
      .glass{
        -webkit-backdrop-filter: blur(14px);
        backdrop-filter: blur(14px);
      }
    }

    .app{
      min-height: 100vh;
      min-height: 100dvh;
      padding: var(--outer);
      width: 100%;
      animation: fadeIn 0.6s ease-out 0.2s both;
    }

    .shell{
      width: min(1800px, calc(100dvw - (2 * var(--outer))));
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      gap: var(--gap);
      min-height: calc(100dvh - (2 * var(--outer)));
    }

    /* HEADER CENTR√â */
    header{
      border-radius: var(--r-xl);
      padding: var(--pad);
      box-shadow: var(--shadow);
      display:flex;
      flex-direction: column;
      align-items:center;
      justify-content: center;
      gap: calc(var(--gap) * 1.2);
      min-height: clamp(130px, 14vh, 160px);
      animation: slideInRight 0.7s ease-out 0.3s both;
      position: relative;
    }

    .brand{
      text-align:center;
      user-select:none;
      line-height:1.05;
    }
    .brand .big{
      font-weight: 300;
      letter-spacing: clamp(1px, .25vw, 2.5px);
      font-size: clamp(32px, 3.6vw, 52px);
      opacity:.92;
      background: linear-gradient(135deg, #fff 0%, var(--accent) 50%, #fff 100%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 3s infinite linear;
      text-shadow: 0 0 30px var(--accent-glow);
      display: block;
      margin-bottom: 2px;
    }
    .brand .small{
      margin-top: 4px;
      font-size: clamp(12px, 1.1vw, 14px);
      letter-spacing: clamp(2px, .35vw, 3.5px);
      color: var(--muted);
      display:inline-flex;
      align-items:center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .brand .small:hover{ 
      color: rgba(255,255,255,.78);
      transform: translateY(-1px);
    }

    .pill{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.70);
      letter-spacing: 1px;
      animation: pulseGlow 2s infinite;
      transition: all 0.3s ease;
    }

    /* BARRE DE RECHERCHE MAGNIFIQUE */
    .search{
      width: min(520px, 85vw);
      height: clamp(44px, 5.2vh, 52px);
      border-radius: 999px;
      display:flex;
      align-items:center;
      gap: 14px;
      padding: 0 20px;
      border: none;
      background: linear-gradient(135deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.05) 100%);
      box-shadow: 
        inset 0 0 0 1px rgba(255,255,255,.16),
        0 8px 32px rgba(0,0,0,.2);
      outline: none !important;
      isolation: isolate;
      transform: translateZ(0);
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .search::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255,255,255,.08), 
        transparent);
      transition: left 0.6s ease;
    }

    .search:hover::before {
      left: 100%;
    }

    .search:focus-within{
      background: linear-gradient(135deg, rgba(255,255,255,.12) 0%, rgba(255,255,255,.08) 100%);
      box-shadow: 
        inset 0 0 0 1.5px rgba(160, 160, 255, .5),
        0 0 30px rgba(160, 160, 255, .2),
        0 12px 40px rgba(0,0,0,.3);
      transform: translateY(-2px) scale(1.02);
    }

    .search *{
      outline: none !important;
      box-shadow: none !important;
    }

    .search-icon-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .search svg{ 
      width: 20px; 
      height: 20px; 
      opacity:.75;
      transition: all 0.3s ease;
      filter: drop-shadow(0 0 8px rgba(160, 160, 255, 0));
    }

    .search:focus-within svg {
      opacity: 1;
      animation: iconFloat 2s ease-in-out infinite;
      filter: drop-shadow(0 0 12px rgba(160, 160, 255, .6));
    }

    .search input{
      width:100%;
      border:0 !important;
      outline:0 !important;
      box-shadow:none !important;
      background:transparent !important;
      color: var(--text);
      font-size: clamp(14px, 1.2vw, 16px);
      font-weight: 400;
      letter-spacing: 0.3px;
    }
    .search input:focus{
      outline:none !important;
      border:none !important;
      box-shadow:none !important;
      background:transparent !important;
    }
    .search input:-webkit-autofill,
    .search input:-webkit-autofill:hover,
    .search input:-webkit-autofill:focus,
    .search input:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 30px transparent inset !important;
      -webkit-text-fill-color: var(--text) !important;
      background: transparent !important;
    }
    .search input::placeholder{ 
      color: rgba(255,255,255,.50);
      font-weight: 300;
      letter-spacing: 0.5px;
    }

    /* Clear button */
    .search-clear {
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 50%;
      width: 26px;
      height: 26px;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .search-clear:hover {
      background: rgba(255,255,255,.15);
      border-color: rgba(255,255,255,.25);
      transform: rotate(90deg) scale(1.1);
    }

    .search-clear.show {
      display: flex;
    }

    .search-clear svg {
      width: 14px;
      height: 14px;
      opacity: .7;
    }

    .main{
      flex: 1;
      min-height: 0;
      display:grid;
      grid-template-columns: var(--side) 1fr;
      gap: var(--gap);
      animation: fadeIn 0.8s ease-out 0.5s both;
    }

    aside{
      border-radius: var(--r-xl);
      padding: var(--pad);
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      min-height: 0;
      animation: slideInLeft 0.7s ease-out 0.6s both;
    }

    aside h2{
      margin: 6px 0 12px;
      text-align:center;
      font-weight: 300;
      letter-spacing: clamp(1px, .3vw, 2.2px);
      font-size: clamp(22px, 2.3vw, 28px);
      color: rgba(255,255,255,.86);
    }

    .catlist{
      display:flex;
      flex-direction:column;
      gap: clamp(10px, 1.2vw, 14px);
      margin-top: clamp(10px, 1.3vw, 18px);
    }

    .catbtn{
      height: clamp(46px, 5.8vh, 54px);
      border-radius: clamp(14px, 1.4vw, 16px);
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 12px;
      font-weight: 520;
      letter-spacing: 1px;
      color: rgba(255,255,255,.70);
      cursor:pointer;
      transition: transform .15s ease, background .15s ease, border-color .15s ease, color .15s ease;
      user-select:none;
    }
    .catbtn:hover{
      background: rgba(255,255,255,.14);
      border-color: rgba(255,255,255,.25);
      transform: translateY(-1px);
      color: rgba(255,255,255,.86);
    }
    .catbtn.active{
      background: rgba(255,255,255,.16);
      border-color: rgba(255,255,255,.28);
      color: rgba(255,255,255,.92);
    }

    .sidefoot{
      margin-top:auto;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      flex-wrap:wrap;
    }

    .sidefoot button{
      height: clamp(38px, 4.5vh, 42px);
      border-radius: clamp(12px, 1.3vw, 14px);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.07);
      color: var(--muted);
      font-size: clamp(11px, 1vw, 12px);
      letter-spacing: .8px;
      cursor:pointer;
      user-select:none;
      padding: 0 clamp(12px, 1.4vw, 16px);
      transition: all .15s ease;
    }
    .sidefoot button:hover{
      background: rgba(255,255,255,.11);
      color: rgba(255,255,255,.8);
      transform: translateY(-1px);
    }

    .content{
      border-radius: var(--r-xl);
      padding: var(--pad);
      box-shadow: var(--shadow);
      min-height: 0;
      overflow-y: auto;
    }

    .nogame{
      text-align:center;
      color: var(--muted);
      font-size: clamp(13px, 1.15vw, 15px);
      margin-top: clamp(30px, 4vh, 50px);
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(var(--cardW), 1fr));
      gap: clamp(14px, 1.6vw, 20px);
    }

    .card{
      border-radius: var(--r-md);
      overflow:hidden;
      cursor:pointer;
      position:relative;
      aspect-ratio: 230/300;
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .card:hover{
      transform: translateY(-4px);
      box-shadow: 0 16px 32px rgba(0,0,0,.5);
    }
    .card img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .card .overlay{
      position:absolute;
      inset:0;
      background: linear-gradient(0deg, rgba(0,0,0,.88), transparent 50%);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-end;
      padding: clamp(10px, 1.2vw, 14px);
      opacity:0;
      transition: opacity .2s ease;
    }
    .card:hover .overlay{ opacity:1; }
    .card .title{
      font-size: clamp(12px, 1.15vw, 13px);
      color: #fff;
      text-align:center;
      font-weight:500;
      letter-spacing: .3px;
    }

    /* MODAL */
    .modal{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.75);
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: var(--outer);
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease;
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
    }
    .modal.open{
      opacity:1;
      pointer-events:auto;
    }
    .modalbox{
      width: min(720px, 96vw);
      max-height: 92dvh;
      border-radius: var(--r-xl);
      padding: var(--pad);
      box-shadow: 0 40px 120px rgba(0,0,0,.7);
      overflow-y:auto;
      position:relative;
      transform: scale(.95);
      transition: transform .25s ease;
    }
    .modal.open .modalbox{ transform: scale(1); }

    .closebtn{
      position:absolute;
      top: 14px;
      right: 14px;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition: all .15s ease;
      z-index:1;
    }
    .closebtn:hover{
      background: rgba(255,255,255,.14);
      transform: rotate(90deg);
    }
    .closebtn svg{ width:16px; height:16px; opacity:.8; }

    .modalcover{
      width:100%;
      max-width:320px;
      margin:0 auto 18px;
      border-radius: var(--r-md);
      overflow:hidden;
      aspect-ratio: 230/300;
    }
    .modalcover img{
      width:100%;
      height:100%;
      object-fit:cover;
    }

    .modalname{
      text-align:center;
      font-size: clamp(20px, 2.3vw, 26px);
      margin: 0 0 14px;
      font-weight: 500;
      letter-spacing: .5px;
    }

    .modalcats{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      margin-bottom:18px;
    }
    .modalcats span{
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.1);
      border: 1px solid rgba(255,255,255,.15);
      font-size: clamp(11px, 1vw, 12px);
      letter-spacing: .8px;
      color: rgba(255,255,255,.75);
    }

    .downloadbtn{
      width:100%;
      height: 48px;
      border-radius: var(--r-md);
      background: linear-gradient(135deg, rgba(255,255,255,.14), rgba(255,255,255,.10));
      border: 1px solid rgba(255,255,255,.22);
      color: var(--text);
      font-size: 15px;
      font-weight: 500;
      letter-spacing: 1px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      transition: all .2s ease;
    }
    .downloadbtn:hover{
      background: linear-gradient(135deg, rgba(255,255,255,.20), rgba(255,255,255,.14));
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,.3);
    }
    .downloadbtn svg{ width:20px; height:20px; }

    /* ADMIN MODAL */
    .adminmodal{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.8);
      z-index:10000;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: var(--outer);
      opacity:0;
      pointer-events:none;
      transition: opacity .3s ease;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }
    .adminmodal.open{
      opacity:1;
      pointer-events:auto;
    }

    .adminbox{
      width: min(1200px, 96vw);
      max-height: 92dvh;
      border-radius: var(--r-xl);
      padding: var(--pad);
      box-shadow: 0 40px 140px rgba(0,0,0,.8);
      overflow-y:auto;
      position:relative;
      transform: scale(.9);
      transition: transform .3s ease;
    }
    .adminmodal.open .adminbox{ transform: scale(1); }

    .admintitle{
      text-align:center;
      font-size: clamp(24px, 2.8vw, 32px);
      margin: 0 0 20px;
      font-weight: 300;
      letter-spacing: 1.5px;
      color: rgba(255,255,255,.88);
    }

    .admingrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(min(100%, 320px), 1fr));
      gap: 18px;
      margin-top: 18px;
    }

    .admincard{
      border-radius: var(--r-md);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding: 16px;
    }

    .admincard h3{
      margin: 0 0 12px;
      font-size: clamp(16px, 1.6vw, 18px);
      font-weight: 500;
      letter-spacing: .8px;
      color: rgba(255,255,255,.85);
    }

    .inputwrap{
      margin-bottom: 12px;
    }

    .inputwrap label{
      display:block;
      margin-bottom: 6px;
      font-size: 12px;
      letter-spacing: .5px;
      color: var(--muted);
    }

    .inputwrap input,
    .inputwrap textarea{
      width:100%;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
      font-size: 13px;
      font-family: inherit;
      transition: all .2s ease;
    }

    .inputwrap input:focus,
    .inputwrap textarea:focus{
      outline:none;
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.22);
    }

    .inputwrap textarea{
      resize:vertical;
      min-height:80px;
    }

    .btnrow{
      display:flex;
      gap:10px;
      margin-top:14px;
    }

    .btnrow button,
    .admincard > button{
      flex:1;
      height:42px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.15);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.8);
      font-size: 13px;
      letter-spacing: .7px;
      cursor:pointer;
      transition: all .15s ease;
      font-weight: 500;
    }

    .btnrow button:hover,
    .admincard > button:hover{
      background: rgba(255,255,255,.14);
      border-color: rgba(255,255,255,.25);
      transform: translateY(-1px);
    }

    .btnrow button.primary{
      background: linear-gradient(135deg, rgba(160,160,255,.25), rgba(160,160,255,.15));
      border-color: rgba(160,160,255,.4);
      color: #fff;
    }

    .btnrow button.primary:hover{
      background: linear-gradient(135deg, rgba(160,160,255,.35), rgba(160,160,255,.22));
    }

    .tagpicker{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:12px;
    }

    .taglabel{
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      font-size: 12px;
      letter-spacing: .6px;
      color: rgba(255,255,255,.65);
      cursor:pointer;
      user-select:none;
      transition: all .15s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .taglabel:hover{
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.20);
    }

    .taglabel.selected{
      background: rgba(160,160,255,.20);
      border-color: rgba(160,160,255,.35);
      color: rgba(255,255,255,.92);
    }

    /* NEW: Category edit button in tag */
    .taglabel .edit-cat-btn {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: rgba(255,255,255,.1);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0;
      transition: all 0.2s ease;
      padding: 0;
      margin-left: 2px;
    }

    .taglabel:hover .edit-cat-btn,
    .taglabel.selected .edit-cat-btn {
      opacity: 1;
    }

    .taglabel .edit-cat-btn:hover {
      background: rgba(255,255,255,.2);
      transform: scale(1.1);
    }

    .taglabel .edit-cat-btn svg {
      width: 10px;
      height: 10px;
      opacity: 0.8;
    }

    .adminlist{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:12px;
      max-height:320px;
      overflow-y:auto;
    }

    .adminitem{
      padding: 10px 12px;
      border-radius: 8px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      transition: all .15s ease;
    }

    .adminitem:hover{
      background: rgba(255,255,255,.06);
    }

    .adminitem span{
      font-size: 13px;
      color: rgba(255,255,255,.75);
      flex:1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .adminitem .actions{
      display:flex;
      gap:6px;
    }

    .adminitem button{
      width:28px;
      height:28px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition: all .15s ease;
    }

    .adminitem button:hover{
      background: rgba(255,255,255,.12);
      transform: scale(1.05);
    }

    .adminitem button svg{
      width:14px;
      height:14px;
      opacity:.75;
    }

    .stats{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap:12px;
      margin-top:14px;
    }

    .stat{
      text-align:center;
      padding:12px;
      border-radius: 10px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
    }

    .stat .num{
      font-size: clamp(22px, 2.5vw, 28px);
      font-weight: 300;
      letter-spacing: .5px;
      color: rgba(255,255,255,.88);
    }

    .stat .lab{
      font-size: 11px;
      letter-spacing: .8px;
      color: var(--muted);
      margin-top: 4px;
    }

    .toast{
      position:fixed;
      bottom: 30px;
      left:50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(20,20,20,.95);
      color: #fff;
      padding: 14px 22px;
      border-radius: 999px;
      font-size: 14px;
      letter-spacing: .5px;
      box-shadow: 0 12px 36px rgba(0,0,0,.5);
      z-index:99999;
      opacity:0;
      pointer-events:none;
      transition: all .3s ease;
      border: 1px solid rgba(255,255,255,.15);
    }

    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(0);
    }

    .statemsg{
      text-align:center;
      padding: 18px;
      border-radius: var(--r-md);
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--muted);
      font-size: 14px;
      letter-spacing: .5px;
      margin-bottom: 18px;
    }

    .preview-section {
      margin-top: 16px;
      padding: 16px;
      border-radius: 12px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.08);
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .preview-section.show {
      opacity: 1;
      max-height: 600px;
    }

    .preview-section h4 {
      margin: 0 0 12px;
      font-size: 14px;
      font-weight: 500;
      letter-spacing: .7px;
      color: rgba(255,255,255,.8);
    }

    .preview-grid {
      display: grid;
      gap: 10px;
    }

    .preview-item {
      padding: 10px 12px;
      border-radius: 8px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      font-size: 13px;
      color: rgba(255,255,255,.75);
    }

    .preview-item strong {
      color: rgba(255,255,255,.85);
      margin-right: 8px;
    }

    .category-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .category-tags .cat-tag {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(160,160,255,.15);
      border: 1px solid rgba(160,160,255,.25);
      font-size: 11px;
      letter-spacing: .5px;
      color: rgba(255,255,255,.8);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .category-tags .cat-tag button {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .category-tags .cat-tag button:hover {
      opacity: 1;
    }

    .category-tags .cat-tag svg {
      width: 12px;
      height: 12px;
    }

    /* NEW: Category editor modal */
    .cat-editor-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .cat-editor-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }

    .cat-editor {
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border: 1px solid var(--stroke);
      border-radius: var(--r-xl);
      padding: 24px;
      width: min(500px, 90vw);
      box-shadow: 0 40px 120px rgba(0,0,0,.8);
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .cat-editor-overlay.open .cat-editor {
      transform: scale(1);
    }

    .cat-editor h3 {
      margin: 0 0 16px;
      font-size: 20px;
      font-weight: 500;
      color: rgba(255,255,255,.9);
      text-align: center;
    }

    .cat-editor .current-cats {
      margin-bottom: 16px;
    }

    .cat-editor .current-cats-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .cat-editor .available-cats {
      margin-top: 16px;
    }

    .cat-editor .available-cats-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .cat-editor .cat-chip {
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.15);
      font-size: 12px;
      letter-spacing: .6px;
      color: rgba(255,255,255,.75);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cat-editor .cat-chip:hover {
      background: rgba(255,255,255,.12);
      border-color: rgba(255,255,255,.25);
    }

    .cat-editor .cat-chip.selected {
      background: rgba(160,160,255,.20);
      border-color: rgba(160,160,255,.35);
      color: rgba(255,255,255,.92);
    }

    .cat-editor .cat-chip svg {
      width: 12px;
      height: 12px;
    }

    .cat-editor .button-row {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .cat-editor button {
      flex: 1;
      height: 42px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.15);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.8);
      font-size: 13px;
      letter-spacing: .7px;
      cursor: pointer;
      transition: all .15s ease;
      font-weight: 500;
    }

    .cat-editor button:hover {
      background: rgba(255,255,255,.14);
      transform: translateY(-1px);
    }

    .cat-editor button.primary {
      background: linear-gradient(135deg, rgba(160,160,255,.25), rgba(160,160,255,.15));
      border-color: rgba(160,160,255,.4);
      color: #fff;
    }

    .cat-editor button.primary:hover {
      background: linear-gradient(135deg, rgba(160,160,255,.35), rgba(160,160,255,.22));
    }

    @media (max-width: 900px){
      .main{
        grid-template-columns: 1fr;
      }
      aside{
        order: 1;
      }
      .content{
        order: 0;
      }
    }

    @media (max-width: 600px){
      header {
        min-height: clamp(120px, 18vh, 150px);
      }
      .brand .big{
        font-size: clamp(28px, 8vw, 42px);
      }
      .search {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="shell">
      <!-- HEADER CENTR√â -->
      <header class="glass" role="banner">
        <div class="brand">
          <div class="big">CRACKUZU</div>
          <div class="small">
            <span>BY CHRUZU</span>
            <span id="adminPill" class="pill" style="display:none;">ADMIN</span>
          </div>
        </div>
        
        <!-- BARRE DE RECHERCHE MAGNIFIQUE -->
        <div class="search">
          <div class="search-icon-wrapper">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
          <input 
            id="q" 
            type="text" 
            placeholder="Rechercher un jeu..."
            autocomplete="off"
            spellcheck="false"
          />
          <div class="search-clear" id="searchClear">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </div>
        </div>
      </header>

      <div class="main">
        <aside class="glass" role="navigation">
          <h2>Cat√©gories</h2>
          <div id="catlist" class="catlist"></div>
          <div class="sidefoot">
            <button id="exportBtn">EXPORT</button>
            <button id="importBtn">IMPORT</button>
          </div>
        </aside>

        <div class="content glass" role="main">
          <div id="stateMsg" class="statemsg" style="display:none;"></div>
          <div id="nogame" class="nogame" style="display:none;">Aucun jeu trouv√©</div>
          <div id="grid" class="grid"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL JEU -->
  <div id="gameModal" class="modal" role="dialog" aria-hidden="true" aria-labelledby="modalTitle">
    <div class="modalbox glass">
      <button class="closebtn" aria-label="Fermer">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
      <div class="modalcover"><img id="modalCover" src="" alt="Cover" /></div>
      <h2 id="modalTitle" class="modalname"></h2>
      <div id="modalCats" class="modalcats"></div>
      <a id="downloadLink" class="downloadbtn" href="" target="_blank" rel="noopener">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
        </svg>
        T√âL√âCHARGER
      </a>
    </div>
  </div>

  <!-- MODAL ADMIN -->
  <div id="adminModal" class="adminmodal" role="dialog" aria-hidden="true" aria-labelledby="adminTitle">
    <div class="adminbox glass">
      <button id="closeAdmin" class="closebtn" aria-label="Fermer">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
      
      <h2 id="adminTitle" class="admintitle">PANNEAU ADMIN</h2>

      <div class="admingrid">
        <!-- AJOUTER CAT√âGORIE -->
        <div class="admincard">
          <h3>Ajouter une cat√©gorie</h3>
          <div class="inputwrap">
            <input id="catName" type="text" placeholder="Nom de la cat√©gorie (ex: FPS)" />
          </div>
          <button id="addCatBtn" class="primary">AJOUTER</button>
        </div>

        <!-- AJOUTER/MODIFIER JEU -->
        <div class="admincard">
          <h3 id="gameFormTitle">Ajouter un jeu</h3>
          
          <div class="inputwrap">
            <label>Nom du jeu</label>
            <input id="gameName" type="text" placeholder="Ex: Cyberpunk 2077" />
          </div>

          <div class="inputwrap">
            <label>Lien Magnet</label>
            <textarea id="gameMagnet" placeholder="magnet:?xt=urn:btih:..."></textarea>
          </div>

          <div class="inputwrap">
            <label>URL de la cover</label>
            <input id="gameCover" type="text" placeholder="https://..." />
          </div>

          <div style="display: flex; gap: 8px; margin-bottom: 12px;">
            <button id="pasteImageBtn" style="flex: 1; height: 36px; font-size: 12px;">
              üìã COLLER IMAGE
            </button>
          </div>

          <div class="inputwrap">
            <label>Cat√©gories</label>
            <div id="tagPicker" class="tagpicker"></div>
          </div>

          <!-- Preview section for auto-detected game -->
          <div id="selectedGamePreview" class="preview-section">
            <h4>üéÆ Jeu d√©tect√©</h4>
            <div class="preview-grid">
              <div class="preview-item">
                <strong>Nom:</strong>
                <span id="previewName"></span>
              </div>
              <div class="preview-item">
                <strong>Cat√©gories d√©tect√©es:</strong>
                <div id="previewCats" class="category-tags"></div>
              </div>
            </div>
          </div>

          <div class="btnrow">
            <button id="addGameBtn" class="primary">AJOUTER JEU</button>
          </div>
          <div class="btnrow" id="editBtns" style="display:none;">
            <button id="saveEditBtn" class="primary">SAUVEGARDER</button>
            <button id="cancelEditBtn">ANNULER</button>
          </div>
        </div>
      </div>

      <!-- LISTES -->
      <div class="admingrid" style="margin-top: 20px;">
        <div class="admincard">
          <h3>Cat√©gories (
<span id="catCount">0</span>)</h3>
          <div id="catAdminList" class="adminlist"></div>
        </div>

        <div class="admincard">
          <h3>Jeux (<span id="gameCount">0</span>)</h3>
          <div class="inputwrap">
            <input id="gameSearchInput" type="text" placeholder="Rechercher un jeu..." />
          </div>
          <div id="gameAdminList" class="adminlist"></div>
        </div>
      </div>

      <!-- STATS -->
      <div class="stats">
        <div class="stat">
          <div class="num" id="statGames">0</div>
          <div class="lab">JEUX</div>
        </div>
        <div class="stat">
          <div class="num" id="statCats">0</div>
          <div class="lab">CAT√âGORIES</div>
        </div>
      </div>

      <div class="btnrow" style="margin-top:20px;">
        <button id="resetBtn">RESET LOCAL</button>
      </div>
    </div>
  </div>

  <!-- Category Editor Modal -->
  <div id="catEditorOverlay" class="cat-editor-overlay">
    <div class="cat-editor glass">
      <h3>Modifier les cat√©gories</h3>
      
      <div class="current-cats">
        <label style="display:block; margin-bottom:8px; font-size:12px; color:var(--muted);">
          Cat√©gories actuelles:
        </label>
        <div id="currentCatsList" class="current-cats-list"></div>
      </div>

      <div class="available-cats">
        <label style="display:block; margin-bottom:8px; font-size:12px; color:var(--muted);">
          Cat√©gories disponibles:
        </label>
        <div id="availableCatsList" class="available-cats-list"></div>
      </div>

      <div class="button-row">
        <button id="cancelCatEdit">Annuler</button>
        <button id="saveCatEdit" class="primary">Sauvegarder</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>
  <div id="adminEntry" style="position:fixed; bottom:20px; right:20px; width:50px; height:50px; border-radius:50%; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1); cursor:pointer; display:flex; align-items:center; justify-content:center; opacity:.3; transition: all .2s ease;" title="Admin">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width:24px; height:24px; opacity:.7;">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
    </svg>
  </div>
  <input type="file" id="filePick" accept="application/json" style="display:none;" />

  <script>
    // CONFIG
    const REPO_OWNER = "Crackuzu";
    const REPO_NAME = "Crackuzu.github.io";
    const DATA_PATH = "data.json";
    const ADMIN_PASSWORD = "admin2025";
    const LOCAL_KEY = "crackuzu_draft";
    const CLOUDINARY_UPLOAD_PRESET = "kkocazrx";
    const CLOUDINARY_CLOUD_NAME = "dhnl0fzwy";

    // DOM
    const q = document.getElementById("q");
    const searchClear = document.getElementById("searchClear");
    const catlist = document.getElementById("catlist");
    const grid = document.getElementById("grid");
    const nogame = document.getElementById("nogame");
    const stateMsg = document.getElementById("stateMsg");

    const gameModal = document.getElementById("gameModal");
    const modalCover = document.getElementById("modalCover");
    const modalTitle = document.getElementById("modalTitle");
    const modalCats = document.getElementById("modalCats");
    const downloadLink = document.getElementById("downloadLink");
    const closeModalBtns = document.querySelectorAll(".closebtn");

    const adminModal = document.getElementById("adminModal");
    const adminEntry = document.getElementById("adminEntry");
    const adminPill = document.getElementById("adminPill");
    const closeAdmin = document.getElementById("closeAdmin");

    const catName = document.getElementById("catName");
    const addCatBtn = document.getElementById("addCatBtn");
    const gameName = document.getElementById("gameName");
    const gameMagnet = document.getElementById("gameMagnet");
    const gameCover = document.getElementById("gameCover");
    const pasteImageBtn = document.getElementById("pasteImageBtn");
    const tagPicker = document.getElementById("tagPicker");
    const addGameBtn = document.getElementById("addGameBtn");
    const saveEditBtn = document.getElementById("saveEditBtn");
    const cancelEditBtn = document.getElementById("cancelEditBtn");
    const editBtns = document.getElementById("editBtns");
    const gameFormTitle = document.getElementById("gameFormTitle");

    const catAdminList = document.getElementById("catAdminList");
    const gameAdminList = document.getElementById("gameAdminList");
    const gameSearchInput = document.getElementById("gameSearchInput");

    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");
    const resetBtn = document.getElementById("resetBtn");
    const filePick = document.getElementById("filePick");

    const statGames = document.getElementById("statGames");
    const statCats = document.getElementById("statCats");
    const catCount = document.getElementById("catCount");
    const gameCount = document.getElementById("gameCount");

    const selectedGamePreview = document.getElementById("selectedGamePreview");
    const previewName = document.getElementById("previewName");
    const previewCats = document.getElementById("previewCats");

    // Category editor modal
    const catEditorOverlay = document.getElementById("catEditorOverlay");
    const currentCatsList = document.getElementById("currentCatsList");
    const availableCatsList = document.getElementById("availableCatsList");
    const cancelCatEdit = document.getElementById("cancelCatEdit");
    const saveCatEdit = document.getElementById("saveCatEdit");

    const toast = document.getElementById("toast");

    // STATE
    const state = {
      data: { games: [], categories: [] },
      activeCat: "ALL",
      query: "",
      adminUnlocked: false,
      selectedCategories: [],
      adminSearchQuery: "",
      editingGameIndex: null,
      editingGameCategories: []
    };

    let editIndex = null;
    let selectedGameData = null;

    // HELPERS
    const norm = (s) => (s || "").trim();
    const upper = (s) => norm(s).toUpperCase();

    function toastMsg(msg) {
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2500);
    }

    function setStateMessage(msg) {
      if (!msg) {
        stateMsg.style.display = "none";
        stateMsg.textContent = "";
      } else {
        stateMsg.textContent = msg;
        stateMsg.style.display = "block";
      }
    }

    function sanitizeData(data) {
      if (!data || typeof data !== "object") return { games: [], categories: [] };
      
      const games = Array.isArray(data.games)
        ? data.games.filter(g => g && g.name && g.magnet && g.cover && Array.isArray(g.categories))
        : [];
      
      const categories = Array.isArray(data.categories)
        ? [...new Set(data.categories.filter(c => typeof c === "string" && c.trim()))]
        : [];
      
      return { games, categories };
    }

    async function loadDataFromRepo() {
      try {
        const url = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${DATA_PATH}`;
        const response = await fetch(url, { cache: "no-store" });
        
        if (!response.ok) {
          console.warn(`GitHub fetch failed: ${response.status}`);
          return null;
        }
        
        const json = await response.json();
        return sanitizeData(json);
      } catch (error) {
        console.error("Error loading from GitHub:", error);
        return null;
      }
    }

    function saveLocalDraft() {
      try {
        localStorage.setItem(LOCAL_KEY, JSON.stringify(state.data));
        localStorage.setItem(LOCAL_KEY + "_lastModified", Date.now().toString());
      } catch (error) {
        console.error("Failed to save draft:", error);
      }
    }

    function loadLocalDraft() {
      try {
        const raw = localStorage.getItem(LOCAL_KEY);
        if (!raw) return null;
        return sanitizeData(JSON.parse(raw));
      } catch (error) {
        console.error("Failed to load draft:", error);
        return null;
      }
    }

    function exitEditMode() {
      editIndex = null;
      gameName.value = "";
      gameMagnet.value = "";
      gameCover.value = "";
      state.selectedCategories = [];
      selectedGameData = null;
      selectedGamePreview.classList.remove('show');
      editBtns.style.display = "none";
      addGameBtn.parentElement.style.display = "flex";
      gameFormTitle.textContent = "Ajouter un jeu";
      renderTagPicker();
    }

    // RENDER FUNCTIONS
    function renderCategories() {
      const all = [
        { name: "ALL", count: state.data.games.length }
      ];

      state.data.categories.forEach(cat => {
        const count = state.data.games.filter(g => g.categories.includes(cat)).length;
        if (count > 0) all.push({ name: cat, count });
      });

      catlist.innerHTML = all.map(c => `
        <div class="catbtn ${state.activeCat === c.name ? "active" : ""}" data-cat="${c.name}">
          <span>${c.name}</span>
          <span style="opacity:.6; font-size:0.9em;">(${c.count})</span>
        </div>
      `).join("");

      catlist.querySelectorAll(".catbtn").forEach(btn => {
        btn.addEventListener("click", () => {
          state.activeCat = btn.dataset.cat;
          renderCategories();
          renderGames();
        });
      });
    }

    function renderGames() {
      let filtered = state.data.games;

      if (state.activeCat !== "ALL") {
        filtered = filtered.filter(g => g.categories.includes(state.activeCat));
      }

      if (state.query) {
        const lq = state.query.toLowerCase();
        filtered = filtered.filter(g => g.name.toLowerCase().includes(lq));
      }

      // Update search clear button
      if (state.query) {
        searchClear.classList.add('show');
      } else {
        searchClear.classList.remove('show');
      }

      if (filtered.length === 0) {
        grid.innerHTML = "";
        nogame.style.display = "block";
        return;
      }

      nogame.style.display = "none";
      grid.innerHTML = filtered.map((g, i) => `
        <div class="card" data-index="${state.data.games.indexOf(g)}">
          <img src="${g.cover}" alt="${g.name}" loading="lazy" />
          <div class="overlay">
            <div class="title">${g.name}</div>
          </div>
        </div>
      `).join("");

      grid.querySelectorAll(".card").forEach(card => {
        card.addEventListener("click", () => {
          const idx = parseInt(card.dataset.index, 10);
          openGameModal(state.data.games[idx]);
        });
      });
    }

    function openGameModal(game) {
      modalCover.src = game.cover;
      modalTitle.textContent = game.name;
      modalCats.innerHTML = game.categories.map(c => `<span>${c}</span>`).join("");
      downloadLink.href = game.magnet;
      gameModal.classList.add("open");
      gameModal.setAttribute("aria-hidden", "false");
    }

    function closeGameModal() {
      gameModal.classList.remove("open");
      gameModal.setAttribute("aria-hidden", "true");
    }

    function renderTagPicker() {
      if (state.data.categories.length === 0) {
        tagPicker.innerHTML = '<div style="color:var(--muted); font-size:12px;">Ajoutez d\'abord des cat√©gories</div>';
        return;
      }

      tagPicker.innerHTML = state.data.categories.map(cat => `
        <div class="taglabel ${state.selectedCategories.includes(cat) ? 'selected' : ''}" data-cat="${cat}">
          <span>${cat}</span>
          ${state.selectedCategories.includes(cat) ? `
            <button class="edit-cat-btn" data-cat="${cat}" type="button" aria-label="Modifier">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
              </svg>
            </button>
          ` : ''}
        </div>
      `).join("");

      tagPicker.querySelectorAll(".taglabel").forEach(label => {
        const cat = label.dataset.cat;
        
        label.addEventListener("click", (e) => {
          // Don't toggle if clicking the edit button
          if (e.target.closest('.edit-cat-btn')) return;
          
          if (state.selectedCategories.includes(cat)) {
            state.selectedCategories = state.selectedCategories.filter(c => c !== cat);
          } else {
            state.selectedCategories.push(cat);
          }
          renderTagPicker();
          
          // Update preview if we have selected game data
          if (selectedGameData) {
            updatePreview();
          }
        });
      });

      // Add click handlers for edit buttons
      tagPicker.querySelectorAll(".edit-cat-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          // For now, just show a placeholder - full implementation below
          openCategoryEditor();
        });
      });
    }

    function openCategoryEditor() {
      state.editingGameCategories = [...state.selectedCategories];
      renderCategoryEditor();
      catEditorOverlay.classList.add('open');
    }

    function closeCategoryEditor() {
      catEditorOverlay.classList.remove('open');
      state.editingGameIndex = null;
      state.editingGameCategories = [];
    }

    function renderCategoryEditor() {
      // Current categories
      currentCatsList.innerHTML = state.editingGameCategories.length === 0
        ? '<div style="color:var(--muted); font-size:12px; padding:8px;">Aucune cat√©gorie s√©lectionn√©e</div>'
        : state.editingGameCategories.map(cat => `
            <div class="cat-chip selected" data-cat="${cat}">
              <span>${cat}</span>
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </div>
          `).join("");

      // Available categories (not currently selected)
      const available = state.data.categories.filter(cat => !state.editingGameCategories.includes(cat));
      availableCatsList.innerHTML = available.length === 0
        ? '<div style="color:var(--muted); font-size:12px; padding:8px;">Toutes les cat√©gories sont d√©j√† ajout√©es</div>'
        : available.map(cat => `
            <div class="cat-chip" data-cat="${cat}">
              <span>${cat}</span>
            </div>
          `).join("");

      // Add click handlers to remove from current
      currentCatsList.querySelectorAll('.cat-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          const cat = chip.dataset.cat;
          state.editingGameCategories = state.editingGameCategories.filter(c => c !== cat);
          renderCategoryEditor();
        });
      });

      // Add click handlers to add from available
      availableCatsList.querySelectorAll('.cat-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          const cat = chip.dataset.cat;
          if (!state.editingGameCategories.includes(cat)) {
            state.editingGameCategories.push(cat);
            renderCategoryEditor();
          }
        });
      });
    }

    function renderAdminLists() {
      // Categories
      catAdminList.innerHTML = state.data.categories.map(cat => `
        <div class="adminitem">
          <span>${cat}</span>
          <div class="actions">
            <button class="delcat" data-cat="${cat}" aria-label="Supprimer ${cat}">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          </div>
        </div>
      `).join("");

      catAdminList.querySelectorAll(".delcat").forEach(btn => {
        btn.addEventListener("click", () => {
          const cat = btn.dataset.cat;
          const ok = confirm(`Supprimer "${cat}" ? Les jeux gardent cette cat√©gorie.`);
          if (!ok) return;

          state.data.categories = state.data.categories.filter(c => c !== cat);
          saveLocalDraft();
          renderCategories();
          renderAdminLists();
          renderTagPicker();
          updateStats();
          toastMsg("Cat√©gorie supprim√©e");
        });
      });

      // Games
      let gamesToShow = state.data.games;
      if (state.adminSearchQuery) {
        const lq = state.adminSearchQuery.toLowerCase();
        gamesToShow = gamesToShow.filter(g => g.name.toLowerCase().includes(lq));
      }

      gameAdminList.innerHTML = gamesToShow.map((g, i) => `
        <div class="adminitem">
          <span>${g.name}</span>
          <div class="actions">
            <button class="editgame" data-index="${state.data.games.indexOf(g)}" aria-label="Modifier ${g.name}">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
              </svg>
            </button>
            <button class="delgame" data-index="${state.data.games.indexOf(g)}" aria-label="Supprimer ${g.name}">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          </div>
        </div>
      `).join("");

      gameAdminList.querySelectorAll(".editgame").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = parseInt(btn.dataset.index, 10);
          const g = state.data.games[idx];
          
          editIndex = idx;
          gameName.value = g.name;
          gameMagnet.value = g.magnet;
          gameCover.value = g.cover;
          state.selectedCategories = [...g.categories];
          
          gameFormTitle.textContent = "Modifier le jeu";
          editBtns.style.display = "flex";
          addGameBtn.parentElement.style.display = "none";
          
          selectedGameData = null;
          selectedGamePreview.classList.remove('show');
          
          renderTagPicker();
          toastMsg("Mode modification");
          
          // Scroll to form
          document.querySelector('.admincard h3').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        });
      });

      gameAdminList.querySelectorAll(".delgame").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = parseInt(btn.dataset.index, 10);
          const g = state.data.games[idx];
          const ok = confirm(`Supprimer "${g.name}" ?`);
          if (!ok) return;

          state.data.games.splice(idx, 1);
          saveLocalDraft();
          renderGames();
          renderCategories();
          renderAdminLists();
          updateStats();
          toastMsg("Jeu supprim√©");
        });
      });
    }

    function updateStats() {
      statGames.textContent = state.data.games.length;
      statCats.textContent = state.data.categories.length;
      catCount.textContent = state.data.categories.length;
      gameCount.textContent = state.data.games.length;
    }

    // AUTO-DETECTION
    async function detectGameInfo(magnetLink) {
      const extractedName = extractGameName(magnetLink);
      if (!extractedName) return null;

      const detectedCategories = detectCategories(extractedName, magnetLink);
      
      return {
        name: extractedName,
        categories: detectedCategories
      };
    }

    function extractGameName(magnetLink) {
      try {
        const match = magnetLink.match(/dn=([^&]+)/);
        if (!match) return null;

        let name = decodeURIComponent(match[1]);
        
        // Clean common patterns
        name = name.replace(/\.(iso|rar|zip|7z|exe|torrent)$/i, '');
        name = name.replace(/\[.*?\]/g, '');
        name = name.replace(/\(.*?\)/g, '');
        name = name.replace(/[-_.]/g, ' ');
        name = name.replace(/\s+/g, ' ');
        name = name.trim();
        
        return name;
      } catch {
        return null;
      }
    }

    function detectCategories(name, magnet) {
      const text = (name + ' ' + magnet).toLowerCase();
      const detected = [];

      const patterns = {
        'FPS': /fps|shooter|call of duty|battlefield|counter.?strike|valorant|apex|overwatch/i,
        'RPG': /rpg|role.?playing|witcher|skyrim|fallout|dragon age|mass effect|final fantasy/i,
        'ACTION': /action|combat|hack.?slash|god of war|devil may cry|bayonetta/i,
        'ADVENTURE': /adventure|exploration|tomb raider|uncharted|assassin/i,
        'STRATEGY': /strategy|rts|civilization|total war|age of empires|starcraft/i,
        'SIMULATION': /sim|simulation|sims|farming|truck|flight/i,
        'RACING': /racing|rally|need for speed|forza|gran turismo|f1/i,
        'SPORTS': /sport|fifa|nba|nfl|mlb|hockey|tennis/i,
        'HORROR': /horror|resident evil|silent hill|outlast|amnesia/i,
        'SURVIVAL': /survival|minecraft|rust|ark|dayz|forest/i,
        'PUZZLE': /puzzle|portal|tetris|brain|match/i,
        'PLATFORM': /platform|mario|sonic|crash bandicoot|rayman/i,
        'FIGHTING': /fighting|mortal kombat|street fighter|tekken|soul calibur/i,
        'OPEN-WORLD': /open.?world|gta|red dead|saints row/i,
        'STEALTH': /stealth|metal gear|hitman|splinter cell|thief/i,
        'CO-OP': /co.?op|coop|multiplayer|online/i,
        'VR': /\bvr\b|virtual reality|oculus|vive/i,
        'INDIE': /indie|independent/i
      };

      for (const [category, pattern] of Object.entries(patterns)) {
        if (pattern.test(text)) {
          detected.push(category);
        }
      }

      return detected.length > 0 ? detected : ['ACTION'];
    }

    function updatePreview() {
      if (!selectedGameData) return;

      previewName.textContent = selectedGameData.name;
      
      // Show current selected categories with ability to remove
      previewCats.innerHTML = state.selectedCategories.map(cat => `
        <span class="cat-tag">
          ${cat}
          <button type="button" data-cat="${cat}" aria-label="Retirer ${cat}">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </span>
      `).join("");

      // Add remove handlers
      previewCats.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const cat = btn.dataset.cat;
          state.selectedCategories = state.selectedCategories.filter(c => c !== cat);
          updatePreview();
          renderTagPicker();
        });
      });
    }

    // Watch magnet field for auto-detection
    gameMagnet.addEventListener('input', async () => {
      const magnet = norm(gameMagnet.value);
      
      if (!magnet.startsWith('magnet:')) {
        selectedGameData = null;
        selectedGamePreview.classList.remove('show');
        return;
      }

      const detected = await detectGameInfo(magnet);
      
      if (detected) {
        selectedGameData = detected;
        
        // Auto-fill name if empty
        if (!gameName.value) {
          gameName.value = detected.name;
        }

        // Set detected categories as selected
        state.selectedCategories = [...detected.categories];
        
        // Ensure detected categories exist in our category list
        detected.categories.forEach(cat => {
          if (!state.data.categories.includes(cat)) {
            state.data.categories.push(cat);
          }
        });

        renderTagPicker();
        updatePreview();
        selectedGamePreview.classList.add('show');
        
        toastMsg(`‚ú® Jeu d√©tect√©: ${detected.name}`);
      }
    });

    // Search clear button
    searchClear.addEventListener('click', () => {
      q.value = '';
      state.query = '';
      searchClear.classList.remove('show');
      renderGames();
    });

    // Cloudinary upload
    async function uploadImageToCloudinary(file) {
      try {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

        const response = await fetch(
          `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,
          {
            method: 'POST',
            body: formData
          }
        );

        if (!response.ok) {
          throw new Error('Upload failed');
        }

        const result = await response.json();
        return result.secure_url || null;
      } catch (error) {
        console.error('Cloudinary error:', error);
        toastMsg("‚ùå Erreur upload");
        return null;
      }
    }

    // Paste image functionality
    pasteImageBtn.addEventListener("click", async () => {
      if (!navigator.clipboard) {
        toastMsg("‚ùå Clipboard API non support√©e");
        return;
      }
      
      try {
        const clipboardItems = await navigator.clipboard.read();
        
        for (const item of clipboardItems) {
          for (const type of item.types) {
            if (type.startsWith('image/')) {
              const blob = await item.getType(type);
              const file = new File([blob], "pasted-image.png", { type: blob.type });
              
              const imageUrl = await uploadImageToCloudinary(file);
              
              if (imageUrl) {
                gameCover.value = imageUrl;
                toastMsg("‚úÖ Image coll√©e et upload√©e!");
              } else {
                toastMsg("‚ùå √âchec de l'upload");
              }
              return;
            }
          }
        }
        
        toastMsg("‚ùå Pas d'image dans le presse-papier");
      } catch (error) {
        console.error("Paste error:", error);
        toastMsg("‚ùå Impossible de lire le presse-papier");
      }
    });

    // Category editor handlers
    cancelCatEdit.addEventListener('click', closeCategoryEditor);
    
    saveCatEdit.addEventListener('click', () => {
      state.selectedCategories = [...state.editingGameCategories];
      renderTagPicker();
      if (selectedGameData) {
        updatePreview();
      }
      closeCategoryEditor();
      toastMsg("Cat√©gories mises √† jour");
    });

    // Event listeners
    q.addEventListener("input", () => {
      state.query = q.value || "";
      renderGames();
    });

    gameSearchInput.addEventListener("input", () => {
      state.adminSearchQuery = gameSearchInput.value || "";
      renderAdminLists();
    });

    addCatBtn.addEventListener("click", () => {
      const name = upper(catName.value);
      if(!name) return toastMsg("Cat√©gorie vide");
      if(name === "ALL") return toastMsg("ALL est r√©serv√©");
      if(state.data.categories.includes(name)) return toastMsg("D√©j√† existe");

      state.data.categories.push(name);
      catName.value = "";
      saveLocalDraft();
      renderCategories();
      renderAdminLists();
      renderTagPicker();
      updateStats();
      toastMsg("Cat√©gorie ajout√©e");
    });

    addGameBtn.addEventListener("click", () => {
      if(editIndex !== null) return toastMsg("Mode modif actif");

      const name = norm(gameName.value);
      const magnet = norm(gameMagnet.value).replaceAll("&amp;", "&");
      const cover = norm(gameCover.value);

      if(!name) return toastMsg("Nom manquant");
      if(!magnet.startsWith("magnet:")) return toastMsg("Magnet invalide");
      if(!cover) return toastMsg("Cover manquante");
      if(state.selectedCategories.length === 0) return toastMsg("Pas de cat√©gories");

      state.selectedCategories.forEach(cat => {
        if(!state.data.categories.includes(cat)){
          state.data.categories.push(cat);
        }
      });

      state.data.games.unshift({ 
        name, 
        categories: [...state.selectedCategories], 
        magnet, 
        cover 
      });

      gameName.value = "";
      gameMagnet.value = "";
      gameCover.value = "";
      state.selectedCategories = [];
      selectedGameData = null;
      selectedGamePreview.classList.remove('show');

      saveLocalDraft();
      renderGames();
      renderCategories();
      renderAdminLists();
      updateStats();
      toastMsg("Jeu ajout√©");
    });

    saveEditBtn.addEventListener("click", () => {
      if(editIndex === null) return;

      const name = norm(gameName.value);
      const magnet = norm(gameMagnet.value).replaceAll("&amp;", "&");
      const cover = norm(gameCover.value);

      if(!name) return toastMsg("Nom manquant");
      if(!magnet.startsWith("magnet:")) return toastMsg("Magnet invalide");
      if(!cover) return toastMsg("Cover manquante");
      if(state.selectedCategories.length === 0) return toastMsg("Pas de cat√©gories");

      state.selectedCategories.forEach(cat => {
        if(!state.data.categories.includes(cat)){
          state.data.categories.push(cat);
        }
      });

      state.data.games[editIndex] = { 
        name, 
        categories: [...state.selectedCategories], 
        magnet, 
        cover 
      };

      saveLocalDraft();
      renderGames();
      renderCategories();
      renderAdminLists();
      updateStats();
      exitEditMode();
      toastMsg("Modif sauvegard√©e");
    });

    cancelEditBtn.addEventListener("click", exitEditMode);

    // Export/Import
    exportBtn.addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(state.data, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "data.json";
      a.click();
      toastMsg("Export r√©ussi");
    });

    importBtn.addEventListener("click", () => filePick.click());
    
    filePick.addEventListener("change", async () => {
      const f = filePick.files?.[0];
      filePick.value = "";
      if(!f) return;
      try{
        const text = await f.text();
        const json = sanitizeData(JSON.parse(text));
        state.data = json;
        saveLocalDraft();
        renderCategories();
        renderGames();
        renderAdminLists();
        updateStats();
        exitEditMode();
        toastMsg("Import OK");
      }catch{
        toastMsg("Import invalide");
      }
    });

    resetBtn.addEventListener("click", () => {
      const ok = confirm("Reset local ? Toutes les modifications non publi√©es seront perdues.");
      if(!ok) return;
      localStorage.removeItem(LOCAL_KEY);
      localStorage.removeItem(LOCAL_KEY + "_lastModified");
      toastMsg("Draft supprim√©");
      init();
      closeAdminModal();
    });

    adminEntry.addEventListener("click", () => {
      const pwd = prompt("Admin password:");
      if(pwd === ADMIN_PASSWORD){
        state.adminUnlocked = true;
        adminPill.style.display = "inline-flex";
        toastMsg("Admin unlocked");
        openAdmin();
      }else{
        toastMsg("Wrong password");
      }
    });

    adminPill.addEventListener("click", openAdmin);

    function openAdmin(){
      adminModal.classList.add("open");
      adminModal.setAttribute("aria-hidden", "false");
      renderAdminLists();
      renderTagPicker();
      updateStats();
    }
    
    function closeAdminModal(){
      adminModal.classList.remove("open");
      adminModal.setAttribute("aria-hidden", "true");
      state.adminSearchQuery = "";
      gameSearchInput.value = "";
    }

    closeAdmin.addEventListener("click", closeAdminModal);
    adminModal.addEventListener("click", (e) => { if(e.target === adminModal) closeAdminModal(); });
    catEditorOverlay.addEventListener("click", (e) => { if(e.target === catEditorOverlay) closeCategoryEditor(); });
    window.addEventListener("keydown", (e) => { 
      if(e.key === "Escape") {
        if (catEditorOverlay.classList.contains('open')) {
          closeCategoryEditor();
        } else {
          closeAdminModal();
          closeGameModal();
        }
      }
    });

    closeModalBtns.forEach(btn => btn.addEventListener("click", closeGameModal));
    gameModal.addEventListener("click", (e) => { if(e.target === gameModal) closeGameModal(); });

    // FONCTION INIT
    async function init(){
      console.log("üéÆ CRACKUZU - Initialisation...");
      setStateMessage("Chargement des jeux...");

      try {
        const data = await loadDataFromRepo();
        
        if (data && data.games && data.games.length > 0) {
          console.log(`‚úÖ ${data.games.length} jeux charg√©s depuis data.json`);
          state.data = data;
          setStateMessage(`‚úÖ ${data.games.length} jeux charg√©s`);
          setTimeout(() => setStateMessage(""), 2000);
        } else {
          const localDraft = loadLocalDraft();
          if (localDraft && localDraft.games && localDraft.games.length > 0) {
            console.log(`üì¶ ${localDraft.games.length} jeux charg√©s depuis le draft local`);
            state.data = localDraft;
            setStateMessage(`üì¶ ${localDraft.games.length} jeux (draft local)`);
            setTimeout(() => setStateMessage(""), 2000);
          } else {
            console.warn("‚ö†Ô∏è Aucun jeu trouv√©. La biblioth√®que est vide.");
            setStateMessage("üì≠ Aucun jeu trouv√©. Ajoutez-en via le panneau admin.");
          }
        }
      } catch (error) {
        console.error("‚ùå Erreur lors du chargement:", error);
        setStateMessage("‚ùå Erreur de chargement. V√©rifiez la console.");
      }

      state.activeCat = "ALL";
      state.query = "";
      q.value = "";

      editIndex = null;
      exitEditMode();

      renderCategories();
      renderGames();
      renderAdminLists();
      updateStats();
      
      console.log("‚úÖ Initialisation termin√©e");
    }

    // D√©marrer l'application
    init();
  </script>
</body>
</html>
